<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns:yui="http://yuilibrary.com/rdf/1.0/yui.rdf#">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>API: TDI   tdi-ajax.js  (YUI Library)</title>

	<link rel="stylesheet" type="text/css" href="assets/reset-fonts-grids-min.css?stamp=1359382025.14" />
	<link rel="stylesheet" type="text/css" href="assets/api.css?stamp=1359382025.14" />

    <script type="text/javascript" src="assets/api-js?stamp=1359382025.14"></script>
    <script type="text/javascript" src="assets/ac-js?stamp=1359382025.14"></script>
</head>

<body id="yahoo-com">

<div id="doc3" class="yui-t2">
	<div id="hd">
        <h1><a href="http://wiki.twinstone.org/display/TDI" title="Twinstone TDI">Twinstone TDI</a></h1>
        <h3>TDI&nbsp; <span class="subtitle">1.5.1</span></h3>
        <a href="./index.html" title="Twinstone TDI">Twinstone TDI</a> 
            &gt; <a href="./module_tdi.html" title="TDI">TDI</a>
                
                 &gt; tdi-ajax.js (source view) 
        <form onsubmit="return false">
            <div id="propertysearch">
                Search: <input autocomplete="off" id="searchinput" />
                <div id="searchresults">
                    &nbsp;
                </div>
            </div>
        </form>
	</div>

	<div id="bd">
		<div id="yui-main">
			<div class="yui-b">
            <form action="#" name="yui-classopts-form" method="get" id="yui-classopts-form">
                <fieldset>
                    <legend>Filters</legend>
                <span class="classopts"><input type="checkbox" name="show_private" id="show_private" /> <label for="show_private">Show Private</label></span>
                <span class="classopts"><input type="checkbox" name="show_protected" id="show_protected" /> <label for="show_protected">Show Protected</label></span>
                <span class="classopts"><input type="checkbox" name="show_deprecated" id="show_deprecated" /> <label for="show_deprecated">Show Deprecated</label></span>
                </fieldset>
            </form>

                    <div id="srcout">
                        <style>
                            #doc3 .classopts { display:none; }
                        </style>
<div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;Basic Ajax functionality for the TDI library. Used to bind DOM events to desired HTML elements</span>
<span class="cm"> * and send the TDI request when the events fire.&lt;/p&gt;</span>
<span class="cm"> * &lt;p&gt;Requires TDI global object.&lt;/p&gt;</span>
<span class="cm"> * @class Ajax</span>
<span class="cm"> * @namespace TDI</span>
<span class="cm"> */</span>
<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

	<span class="cm">/**</span>
<span class="cm">	 * &lt;p&gt;Selectors for ajax enabled elements:&lt;/p&gt;</span>
<span class="cm">	 * &lt;ul&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;a.tdi&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;form.tdi&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;form.tdi input[type=submit], form.tdi button&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;select.tdi, input[type=checkbox].tdi, input[type=radio].tdi&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;input[type=text].tdi&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 * &lt;/ul&gt;</span>
<span class="cm">	 * @property _delegateSelectors</span>
<span class="cm">	 * @private</span>
<span class="cm">	 * @final</span>
<span class="cm">	 */</span>
	<span class="kd">var</span> <span class="nx">_delegateSelectors</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">linkClick</span>			<span class="o">:</span> <span class="s1">&#39;a.ajaxlink, a.tdi, a.infuse&#39;</span><span class="p">,</span>
		<span class="nx">formSubmit</span>			<span class="o">:</span> <span class="s1">&#39;form.ajaxform, form.tdi, form.infuse&#39;</span><span class="p">,</span>
		<span class="nx">formButtonActivate</span>	<span class="o">:</span> <span class="s1">&#39;form.ajaxform [type=submit], form.tdi [type=submit], form.infuse [type=submit]&#39;</span><span class="p">,</span>
		<span class="nx">fieldChange</span>			<span class="o">:</span> <span class="s1">&#39;select.ajaxselect, select.tdi, select.infuse, input[type=checkbox].tdi, input[type=checkbox].infuse, input[type=radio].tdi, input[type=radio].infuse&#39;</span><span class="p">,</span>
		<span class="nx">fieldSubmit</span>			<span class="o">:</span> <span class="s1">&#39;input[type=text].tdi, input[type=text].infuse&#39;</span>
	<span class="p">};</span>

	<span class="cm">/**</span>
<span class="cm">	 * &lt;p&gt;Bind all the needed DOM events for Ajax enabled elements:&lt;/p&gt;</span>
<span class="cm">	 * &lt;ul&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onclick&lt;/code&gt; - ajax enabled links and submit buttons&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onsubmit&lt;/code&gt; - ajax enabled forms&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onchange&lt;/code&gt; - ajax enabled form fields&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onunload&lt;/code&gt; - window&lt;/li&gt;</span>
<span class="cm">	 * &lt;/ul&gt;</span>
<span class="cm">	 * @method _bindUI</span>
<span class="cm">	 * @private</span>
<span class="cm">	 */</span>
	<span class="kd">function</span> <span class="nx">_bindUI</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">delegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">formSubmit</span><span class="p">,</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">_onBeforeFormSubmit</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">delegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">linkClick</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_onBeforeLinkClick</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">delegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">formButtonActivate</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_onFormButtonActivate</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">delegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">fieldChange</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">_onFieldChange</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">delegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">fieldSubmit</span><span class="p">,</span> <span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="nx">_onFieldSubmit</span> <span class="p">);</span>

		<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">unload</span><span class="p">(</span> <span class="nx">_unbindUI</span> <span class="p">);</span>

		<span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="s1">&#39;tdi:ajax:beforeLinkClick&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">_default</span> <span class="o">:</span> <span class="nx">_onLinkClick</span>
		<span class="p">};</span>
		<span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="s1">&#39;tdi:ajax:beforeFormSubmit&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">_default</span> <span class="o">:</span> <span class="nx">_onFormSubmit</span>
		<span class="p">};</span>
	<span class="p">}</span>

	<span class="cm">/**</span>
<span class="cm">	 * &lt;p&gt;Unbind all previously attached DOM event handlers:&lt;/p&gt;</span>
<span class="cm">	 * &lt;ul&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onclick&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onsubmit&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onchange&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 *   &lt;li&gt;&lt;code&gt;onunload&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 * &lt;/ul&gt;</span>
<span class="cm">	 * @method _unbindUI</span>
<span class="cm">	 * @private</span>
<span class="cm">	 */</span>
	<span class="kd">function</span> <span class="nx">_unbindUI</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">undelegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">linkClick</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_onLinkClick</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">undelegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">formSubmit</span><span class="p">,</span> <span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">_onBeforeFormSubmit</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">undelegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">formButtonActivate</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_onFormButtonActivate</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">undelegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">fieldChange</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">_onFieldChange</span> <span class="p">)</span>
			<span class="p">.</span><span class="nx">undelegate</span><span class="p">(</span> <span class="nx">_delegateSelectors</span><span class="p">.</span><span class="nx">fieldSubmit</span><span class="p">,</span> <span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="nx">_onFieldSubmit</span> <span class="p">);</span>
	<span class="p">}</span>

	<span class="c1">// EVENT HANDLERS ------------------------------------------------------------</span>
		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The link onclick event handler. Used to trigger the preventable &lt;code&gt;tdi:ajax:beforeLinkClick&lt;/code&gt; event.&lt;/p&gt;</span>
<span class="cm">		 * @method _onBeforeLinkClick</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Event} evt The event object</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeLinkClick</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

			<span class="cm">/**</span>
<span class="cm">			 * &lt;p&gt;Fires before the link is clicked (before the link action is executed).&lt;/p&gt;</span>
<span class="cm">			 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;_onLinkClick&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">			 * @event tdi:ajax:beforeLinkClick</span>
<span class="cm">			 * @param {Event} evt The event object</span>
<span class="cm">			 * @param {Object} data The event data:</span>
<span class="cm">			 *   &lt;dl&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;link&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The link object&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;/dl&gt;</span>
<span class="cm">			 */</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeLinkClick&#39;</span><span class="p">,</span> <span class="p">{</span>
				<span class="nx">link</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
			<span class="p">}</span> <span class="p">);</span>

			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The link onclick event handler.&lt;/p&gt;</span>
<span class="cm">		 * @method _onLinkClick</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Event} evt The event object</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onLinkClick</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The form onsubmit event handler. Used to trigger the preventable &lt;code&gt;tdi:ajax:beforeFormSubmit&lt;/code&gt; event.&lt;/p&gt;</span>
<span class="cm">		 * @method _onBeforeFormSubmit</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Event} evt The event object</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeFormSubmit</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

			<span class="cm">/**</span>
<span class="cm">			 * &lt;p&gt;Fires before the form is submited.&lt;/p&gt;</span>
<span class="cm">			 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;_onFormSubmit&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">			 * @event tdi:ajax:beforeFormSubmit</span>
<span class="cm">			 * @param {Event} evt The event object</span>
<span class="cm">			 * @param {Object} data The event data:</span>
<span class="cm">			 *   &lt;dl&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The form object&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;/dl&gt;</span>
<span class="cm">			 */</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeFormSubmit&#39;</span><span class="p">,</span> <span class="p">{</span>
				<span class="nx">form</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
			<span class="p">}</span> <span class="p">);</span>

			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The form onsubmit event default method.&lt;/p&gt;</span>
<span class="cm">		 * @method _onFormSubmit</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Event} evt The event object</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onFormSubmit</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;Saves the &lt;code&gt;name&lt;/code&gt; and &lt;code&gt;value&lt;/code&gt; of the submit button which the user used to</span>
<span class="cm">		 * submit the form.&lt;/p&gt;</span>
<span class="cm">		 * @method _onFormButtonActivate</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Event} evt The event object</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onFormButtonActivate</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">$button</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
				<span class="nx">$form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">form</span><span class="p">);</span>

			<span class="c1">// save the used submit button</span>
				<span class="nx">$form</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;_submitButton&#39;</span><span class="p">,</span> <span class="nx">$button</span> <span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">$button</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;name&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="c1">// remove the old field</span>
					<span class="nx">$form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s1">&#39;input.submit-action&#39;</span> <span class="p">).</span><span class="nx">remove</span><span class="p">();</span>

				<span class="c1">// create a new field with the buttons name and value</span>
					<span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;&lt;input&gt;&#39;</span> <span class="p">)</span>
						<span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;hidden&#39;</span> <span class="p">)</span>
						<span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">$button</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;name&#39;</span> <span class="p">)</span> <span class="p">)</span>
						<span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">$button</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;value&#39;</span> <span class="p">)</span> <span class="p">)</span>
						<span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s1">&#39;submit-action&#39;</span> <span class="p">)</span>
						<span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span> <span class="nx">$form</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The field onchange event handler. If the field has the &lt;code&gt;data-ajax-url&lt;/code&gt; attribute</span>
<span class="cm">		 * it is used as the trigger element. Otherwise, the fields form is considered to be the trigger</span>
<span class="cm">		 * element.&lt;/p&gt;</span>
<span class="cm">		 * @method _onFieldChange</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Event} evt The event object</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onFieldChange</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;ajax-url&#39;</span> <span class="p">)</span> <span class="o">?</span> <span class="k">this</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">form</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The field onkeydown event handler. If the field has the &lt;code&gt;data-ajax-url&lt;/code&gt; attribute,</span>
<span class="cm">		 * a TDI ajax request is sent when Enter is pressed.&lt;/p&gt;</span>
<span class="cm">		 * @method _onFieldSubmit</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Event} evt The event object</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onFieldSubmit</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">13</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;ajax-url&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

	<span class="c1">// initialization</span>
		<span class="nx">_bindUI</span><span class="p">();</span>

	<span class="c1">// PUBLIC STUFF ------------------------------------------------------------</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="cm">/**</span>
<span class="cm">			 * &lt;p&gt;Universal method for sending a TDI.Ajax call. It is called internaly for all Ajax enabled</span>
<span class="cm">			 * elements (like Links, Forms, Selects, Inputs). This method may be used in other scripts as &lt;code&gt;TDI.Ajax.send( elm );&lt;/code&gt; where the &lt;code&gt;elm&lt;/code&gt; parameter points to the element, which would trigger the Ajax call if it was Ajax enabled.&lt;/p&gt;</span>
<span class="cm">			 *</span>
<span class="cm">			 * &lt;dl&gt;</span>
<span class="cm">			 *   &lt;dt&gt;There are some HTML attributes of the element, which are used to configure the call:&lt;/dt&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The target URL of the Ajax call&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;action&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The same as &lt;strong&gt;href&lt;/strong but used at Form elements&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-ajax-url&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The target URL of the Ajax call. Used if the Ajax URL should be different than the one defined by &lt;strong&gt;href&lt;/strong&gt; or &lt;strong&gt;action&lt;/strong&gt; attributes, or if the HTML element does not have URL attributes (select, input, ...)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-related-element&lt;/span&gt;&lt;/code&gt; &lt;span&gt;A selector pointing to a related element. This element(s) gets notified when the Ajax call starts/ends.&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd class=&quot;parameter_deprecated&quot;&gt;&lt;code&gt;&lt;span&gt;rel&lt;/span&gt;&lt;/code&gt; &lt;span&gt;(deprecated; use &lt;strong&gt;data-related-element&lt;/strong&gt; instead) The same as &lt;strong&gt;data-related-element&lt;/strong&gt;&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-related-ancestor&lt;/span&gt;&lt;/code&gt; &lt;span&gt;A selector pointing to a related parent element. This element gets notified when the Ajax call starts/ends&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-confirm&lt;/span&gt;&lt;/code&gt; &lt;span&gt;A confirmation message. Use when the user should be able to stop the Ajax call&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;disabled&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The Ajax call does not start if the element has the &lt;strong&gt;disabled&lt;/strong&gt; atribute set&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;class=&quot;disabled&quot;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The Ajax call does not start if the element has a &lt;strong&gt;disabled&lt;/strong&gt; class name&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 * &lt;/dl&gt;</span>
<span class="cm">			 * @method send</span>
<span class="cm">			 * @static</span>
<span class="cm">			 * @param {(String|jQuery|HTMLElement)} elm The element which is used as a trigger for the Ajax call.</span>
<span class="cm">			 * @param {Object} callbacks An optional set of callbacks:</span>
<span class="cm">			 *   &lt;dl&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeStart&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;If it returns false, the AJAX call and the default &lt;code&gt;start&lt;/code&gt; callback will not be executed.&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;start&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/dd&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeEnd&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;If it returns false, the default &lt;code&gt;end&lt;/code&gt; callback will not be executed.&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;end&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;/dl&gt;</span>
<span class="cm">			 */</span>
			<span class="nx">send</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">elm</span><span class="p">,</span> <span class="nx">callbacks</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">callbacks</span> <span class="o">||</span> <span class="p">{};</span>

				<span class="kd">var</span> <span class="nx">$elm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">elm</span><span class="p">),</span>
					<span class="nx">name</span> <span class="o">=</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;name&#39;</span> <span class="p">),</span>
					<span class="nx">value</span> <span class="o">=</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
					<span class="nx">confirm</span> <span class="o">=</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;confirm&#39;</span> <span class="p">),</span>
					<span class="nx">related</span> <span class="o">=</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;related-ancestor&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span> <span class="p">).</span><span class="nx">add</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;related-element&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">).</span><span class="nx">add</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;rel&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">).</span><span class="nx">add</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;_submitButton&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">),</span>
					<span class="nx">triggerGroup</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;trigger-group&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span> <span class="p">),</span>
					<span class="nx">url</span> <span class="o">=</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;ajax-url&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;href&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;action&#39;</span> <span class="p">),</span>
					<span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>

				<span class="c1">// if the URL is empty, try to use $elm.value</span>
					<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">url</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">url</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">url</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
					<span class="p">}</span>

				<span class="c1">// if the element has a name and value, append it to the GET URL</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="p">)</span> <span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span> <span class="s1">&#39;input[type=checkbox]&#39;</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;checked&#39;</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">data</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="k">else</span> <span class="p">{</span>
							<span class="nx">data</span><span class="p">[</span> <span class="nx">name</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>

				<span class="c1">// check for obstacles</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span> <span class="s1">&#39;[disabled], .disabled&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
						<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">confirm</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">confirm</span><span class="p">(</span> <span class="nx">confirm</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
						<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
					<span class="p">}</span>

				<span class="kd">var</span> <span class="nx">_options</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">beforeStart</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">beforeStart</span> <span class="o">&amp;&amp;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">beforeStart</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">res</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">res</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">$elm</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">related</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="s1">&#39;loading&#39;</span> <span class="p">);</span>
							<span class="nx">triggerGroup</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
								<span class="kd">var</span> <span class="nx">$trigger</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
								<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">$trigger</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="s1">&#39;disabled&#39;</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">$trigger</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;disabled&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
									<span class="nx">$trigger</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s1">&#39;disabled&#39;</span> <span class="p">).</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
									<span class="nx">$trigger</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;_disabled&#39;</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
								<span class="p">}</span>
							<span class="p">}</span> <span class="p">);</span>
							<span class="cm">/* deprecated */</span>
								<span class="nx">related</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">related</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s1">&#39;loading-target&#39;</span> <span class="p">);</span>

							<span class="nx">callbacks</span><span class="p">.</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
							<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
					<span class="p">},</span>
					<span class="nx">beforeEnd</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">beforeEnd</span> <span class="o">&amp;&amp;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">beforeEnd</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">res</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">res</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">$elm</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">related</span> <span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s1">&#39;loading&#39;</span> <span class="p">);</span>
							<span class="nx">triggerGroup</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">$trigger</span> <span class="p">)</span> <span class="p">{</span>
								<span class="kd">var</span> <span class="nx">$trigger</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
								<span class="k">if</span> <span class="p">(</span> <span class="nx">$trigger</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;_disabled&#39;</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
									<span class="nx">$trigger</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s1">&#39;disabled&#39;</span> <span class="p">).</span><span class="nx">prop</span><span class="p">(</span> <span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>
									<span class="nx">$trigger</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;_disabled&#39;</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>
								<span class="p">}</span>
							<span class="p">}</span> <span class="p">);</span>
							<span class="cm">/* deprecated */</span>
								<span class="nx">related</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">related</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s1">&#39;loading-target&#39;</span> <span class="p">);</span>

							<span class="nx">callbacks</span><span class="p">.</span><span class="nx">end</span> <span class="o">&amp;&amp;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">end</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
						<span class="p">}</span>
					<span class="p">},</span>
					<span class="nx">data</span> <span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
					<span class="nx">trigger</span> <span class="o">:</span> <span class="nx">$elm</span>
				<span class="p">};</span>

				<span class="k">if</span> <span class="p">(</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span> <span class="s1">&#39;form&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">$elm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[type=file]&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">sendForm</span><span class="p">(</span> <span class="nx">$elm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">_options</span> <span class="p">);</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="nx">_options</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">serialize</span><span class="p">();</span> <span class="c1">// safe to overwrite</span>
						<span class="nx">_options</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="nx">$elm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">);</span>
						<span class="nx">_options</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
							<span class="nx">$elm</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;_submitButton&#39;</span><span class="p">,</span> <span class="kc">null</span> <span class="p">);</span>
							<span class="nx">$elm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s1">&#39;input.submit-action&#39;</span> <span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
						<span class="p">};</span>

						<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">_options</span> <span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">_options</span> <span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">};</span>

<span class="p">}(</span><span class="nx">jQuery</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;The Request API for the TDI Ajax. Provides methods to send TDI requests.&lt;/p&gt;</span>
<span class="cm"> * @class Request</span>
<span class="cm"> * @namespace TDI.Ajax</span>
<span class="cm"> */</span>
<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">return</span> <span class="p">{</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;Sends the Ajax request and calls the needed callback methods.&lt;/p&gt;</span>
<span class="cm">		 * @method send</span>
<span class="cm">		 * @static</span>
<span class="cm">		 * @param {String} url The request URL.</span>
<span class="cm">		 * @param {Object} options Aditional request options:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;method&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;The HTTP method used to send the request. Defaults to &lt;em&gt;get&lt;/em&gt;.&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;data&lt;/span&gt; &lt;span&gt;&amp;lt;(String|Object)&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Data to be sent to the server. It is converted to a query string, if not already a string. See jQuery documentation for &lt;a href=&quot;http://api.jquery.com/jQuery.ajax/&quot;&gt;$.ajax()&lt;/a&gt;&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeStart&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called before the request is sent. If this function returns &lt;em&gt;false&lt;/em&gt;, the request is not sent. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; the jqXHR object&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;settings&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; The settings map used in the jQuery $.ajax call&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;</span>
<span class="cm">		 *         &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;start&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called before the request is sent. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; The jqXHR object&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;settings&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; The settings map used in the jQuery $.ajax call&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;</span>
<span class="cm">		 *          &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeEnd&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called after the request is complete. If this function returns &lt;em&gt;false&lt;/em&gt;, the default &lt;em&gt;end&lt;/em&gt; callback is not executed. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; The jqXHR object&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;textStatus&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt; Status of the request (&quot;success&quot;, &quot;notmodified&quot;, &quot;error&quot;, &quot;timeout&quot;, &quot;abort&quot;, or &quot;parsererror&quot;)&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;</span>
<span class="cm">		 *         &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;end&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called after the request is complete. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; The jqXHR object&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;textStatus&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt; Status of the request (&quot;success&quot;, &quot;notmodified&quot;, &quot;error&quot;, &quot;timeout&quot;, &quot;abort&quot;, or &quot;parsererror&quot;)&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/&gt;</span>
<span class="cm">		 *         &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="nx">send</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
			<span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">ajaxifyUrl</span><span class="p">(</span> <span class="nx">url</span> <span class="p">);</span>

			<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span> <span class="p">{</span>
				<span class="nx">url</span>			<span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
				<span class="nx">type</span>		<span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">method</span> <span class="o">||</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
				<span class="nx">data</span>		<span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
				<span class="nx">dataType</span>	<span class="o">:</span> <span class="s1">&#39;xml&#39;</span><span class="p">,</span>
				<span class="nx">beforeSend</span>	<span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">settings</span> <span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeStart</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeStart</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">res</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">res</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_start&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">settings</span> <span class="o">:</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
						<span class="c1">// TDI.Ajax.Response._start( xhr, settings, options );</span>
						<span class="nx">options</span><span class="p">.</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
						<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">},</span>
				<span class="nx">success</span>		<span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">xhr</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_success&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">data</span> <span class="o">:</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span> <span class="o">:</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
					<span class="c1">// TDI.Ajax.Response._success( data, textStatus, xhr, options );</span>
					<span class="nx">options</span><span class="p">.</span><span class="nx">success</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">xhr</span> <span class="p">);</span>
				<span class="p">},</span>
				<span class="nx">error</span>		<span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_error&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span> <span class="o">:</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span> <span class="o">:</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
					<span class="c1">// TDI.Ajax.Response._error( xhr, textStatus, error, options );</span>
					<span class="nx">options</span><span class="p">.</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span> <span class="p">);</span>
				<span class="p">},</span>
				<span class="nx">complete</span>	<span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span> <span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeEnd</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeEnd</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">res</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="nx">res</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_end&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span> <span class="o">:</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
						<span class="c1">// TDI.Ajax.Response._end( xhr, textStatus, options );</span>
						<span class="nx">options</span><span class="p">.</span><span class="nx">end</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="p">);</span>
		<span class="p">},</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;Submits a form using an Iframe (fake Ajax call).&lt;/p&gt;</span>
<span class="cm">		 * @method sendForm</span>
<span class="cm">		 * @static</span>
<span class="cm">		 * @param {String|jQuery|HTMLElement} form The form element which will be sent.</span>
<span class="cm">		 * @param {Object} options Aditional request options:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeStart&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called before the request is sent. If this function returns &lt;em&gt;false&lt;/em&gt;, the request is not sent. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which is to be submited&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;</span>
<span class="cm">		 *         &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;start&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called before the request is sent. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which is to be submited&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;</span>
<span class="cm">		 *         &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeEnd&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called after the request is complete. If this function returns &lt;em&gt;false&lt;/em&gt;, the default &lt;em&gt;end&lt;/em&gt; callback is not executed. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which was submited&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xml&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The response XML document&lt;/dd&gt;</span>
<span class="cm">		 *         &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;end&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *         &lt;span&gt;Function to be called after the request is complete. This function is called with parameters:&lt;/span&gt;</span>
<span class="cm">		 *         &lt;dl&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which was submited&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;</span>
<span class="cm">		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xml&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The response XML document&lt;/dd&gt;</span>
<span class="cm">		 *         &lt;/dl&gt;</span>
<span class="cm">		 *       &lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="nx">sendForm</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">form</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

			<span class="kd">var</span> <span class="nx">$form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">),</span>
				<span class="nx">$submitButton</span> <span class="o">=</span> <span class="nx">$form</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;_submitButton&#39;</span> <span class="p">),</span>
				<span class="nx">url</span> <span class="o">=</span> <span class="nx">$form</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span> <span class="s1">&#39;ajax-url&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="nx">$form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;action&#39;</span> <span class="p">);</span>

			<span class="c1">// onStart</span>
				<span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nx">ajaxifyUrl</span><span class="p">(</span> <span class="nx">url</span> <span class="p">);</span>
				<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeStart</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeStart</span><span class="p">(</span> <span class="nx">$form</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">res</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_start&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">$form</span><span class="p">,</span> <span class="nx">settings</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
				<span class="c1">// TDI.Ajax.Response._start( $form, null, options );</span>
				<span class="nx">options</span><span class="p">.</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span> <span class="nx">$form</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">$submitButton</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">$submitButton</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s1">&#39;loading&#39;</span> <span class="p">);</span>
				<span class="p">}</span>

			<span class="c1">// prepare the form and its iframe</span>
				<span class="kd">var</span> <span class="nx">iframeName</span> <span class="o">=</span> <span class="s1">&#39;form_iframe_&#39;</span><span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">(),</span>
					<span class="nx">iframe</span><span class="p">;</span>

					<span class="c1">// IE8- has a problem assigning the `name` attribute to a dynamicaly created Iframe. It needs to be created as a string.</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentMode</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentMode</span> <span class="o">&lt;=</span> <span class="mi">8</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="s1">&#39;&lt;iframe name=&quot;&#39;</span> <span class="o">+</span> <span class="nx">iframeName</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="p">);</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="s1">&#39;iframe&#39;</span> <span class="p">);</span>
						<span class="nx">iframe</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
					<span class="p">}</span>

					<span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
					<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">iframe</span> <span class="p">);</span>

					<span class="c1">// onComplete/onEnd</span>
						<span class="nx">$</span><span class="p">(</span><span class="nx">iframe</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
							<span class="kd">var</span> <span class="nx">xml</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">XMLDocument</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">,</span>
								<span class="nx">xhr</span> <span class="o">=</span> <span class="p">{</span>
									<span class="nx">responseXML</span> <span class="o">:</span> <span class="nx">xml</span><span class="p">,</span>
									<span class="nx">responseText</span> <span class="o">:</span> <span class="p">(</span><span class="nx">xml</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span> <span class="o">?</span> <span class="nx">xml</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">:</span> <span class="kc">null</span>
								<span class="p">};</span>

							<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeEnd</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeEnd</span><span class="p">(</span> <span class="nx">$form</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">xml</span> <span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span> <span class="nx">res</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
								<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
							<span class="p">}</span>

							<span class="k">if</span> <span class="p">(</span> <span class="nx">$submitButton</span> <span class="p">)</span> <span class="p">{</span>
								<span class="nx">$submitButton</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s1">&#39;loading&#39;</span> <span class="p">);</span>
							<span class="p">}</span>

							<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_success&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">data</span> <span class="o">:</span> <span class="nx">xml</span><span class="p">,</span> <span class="nx">textStatus</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
							<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_end&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">$form</span><span class="p">,</span> <span class="nx">textStatus</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
							<span class="nx">$form</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_formSubmit&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">form</span> <span class="o">:</span> <span class="nx">$form</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">xhr</span> <span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">data</span> <span class="o">:</span> <span class="nx">xml</span> <span class="p">}</span> <span class="p">);</span>
							<span class="c1">// TDI.Ajax.Response._success( xml, &#39;&#39;, null, options );</span>
							<span class="c1">// TDI.Ajax.Response._end( $form, null, options );</span>
							<span class="nx">options</span><span class="p">.</span><span class="nx">end</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span> <span class="nx">$form</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">xml</span> <span class="p">);</span>

							<span class="nx">setTimeout</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
								<span class="nx">$</span><span class="p">(</span><span class="nx">iframe</span><span class="p">).</span><span class="nx">unbind</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
								<span class="nx">$form</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span> <span class="s1">&#39;target&#39;</span> <span class="p">);</span>
							<span class="p">},</span> <span class="mi">100</span> <span class="p">);</span>
						<span class="p">}</span> <span class="p">);</span>

					<span class="nx">$form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="p">);</span>
					<span class="nx">$form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span> <span class="p">);</span>
					<span class="nx">$form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="nx">iframeName</span> <span class="p">);</span>
					<span class="nx">$form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;enctype&#39;</span><span class="p">,</span> <span class="s1">&#39;multipart/form-data&#39;</span> <span class="p">);</span>

			<span class="cm">/*</span>
<span class="cm">				Send the $form manualy.</span>
<span class="cm">				Needs to be the normal DOM method, jQuery submit() causes endless recursion of submit handlers.</span>
<span class="cm">			*/</span>
				<span class="nx">$form</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">submit</span><span class="p">();</span>
		<span class="p">},</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;Modifies the URL and adds an Ajax (tdi) flag.&lt;/p&gt;</span>
<span class="cm">		 * @method ajaxifyUrl</span>
<span class="cm">		 * @static</span>
<span class="cm">		 * @param {String} url The URL to modify</span>
<span class="cm">		 * @return {String} The modified URL</span>
<span class="cm">		 */</span>
		<span class="nx">ajaxifyUrl</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">url</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="s1">&#39;_infuse=1&amp;_ts=&#39;</span><span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="s1">&#39;?#&#39;</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/\?#/</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="o">+</span><span class="nx">p</span><span class="o">+</span><span class="s1">&#39;#&#39;</span> <span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="s1">&#39;&amp;#&#39;</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/&amp;#/</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">+</span><span class="nx">p</span><span class="o">+</span><span class="s1">&#39;#&#39;</span> <span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="s1">&#39;?&#39;</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/\?/</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="o">+</span><span class="nx">p</span><span class="o">+</span><span class="s1">&#39;&amp;&#39;</span> <span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="s1">&#39;#&#39;</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/#/</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="o">+</span><span class="nx">p</span><span class="o">+</span><span class="s1">&#39;#&#39;</span> <span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span><span class="o">+</span><span class="nx">p</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

	<span class="p">};</span>

<span class="p">}(</span><span class="nx">jQuery</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * &lt;p&gt;The Response API for the TDI AJAX. Provides a set of custom &lt;em&gt;tdi&lt;/em&gt; events which can be used</span>
<span class="cm"> * to control or to react to the TDI responses.&lt;/p&gt;</span>
<span class="cm"> * @class Response</span>
<span class="cm"> */</span>
<span class="nx">TDI</span><span class="p">.</span><span class="nx">Ajax</span><span class="p">.</span><span class="nx">Response</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// Listen for ajax internal events</span>
		<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_start&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">_start</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">options</span> <span class="p">);</span>
		<span class="p">}</span> <span class="p">);</span>
		<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_success&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">_success</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">textStatus</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">options</span> <span class="p">);</span>
		<span class="p">}</span> <span class="p">);</span>
		<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">_error</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">textStatus</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">options</span> <span class="p">);</span>
		<span class="p">}</span> <span class="p">);</span>
		<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:_end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">_end</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">textStatus</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">options</span> <span class="p">);</span>
		<span class="p">}</span> <span class="p">);</span>

	<span class="c1">// Supported Infusion instructions</span>
		<span class="kd">var</span> <span class="nx">_infusionInstructions</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s1">&#39;update&#39;</span>	<span class="o">:</span> <span class="nx">_onBeforeUpdate</span><span class="p">,</span>
				<span class="s1">&#39;insert&#39;</span>	<span class="o">:</span> <span class="nx">_onBeforeInsert</span><span class="p">,</span>
				<span class="s1">&#39;script&#39;</span>	<span class="o">:</span> <span class="nx">_onBeforeScript</span><span class="p">,</span>
				<span class="s1">&#39;style&#39;</span>		<span class="o">:</span> <span class="nx">_onBeforeStyle</span><span class="p">,</span>
				<span class="s1">&#39;reload&#39;</span>	<span class="o">:</span> <span class="nx">_onBeforeReload</span><span class="p">,</span>
				<span class="s1">&#39;redirect&#39;</span>	<span class="o">:</span> <span class="nx">_onBeforeRedirect</span><span class="p">,</span>
				<span class="s1">&#39;popup&#39;</span>		<span class="o">:</span> <span class="nx">_onBeforePopup</span><span class="p">,</span>
				<span class="s1">&#39;message&#39;</span>	<span class="o">:</span> <span class="nx">_onBeforeMessage</span><span class="p">,</span>
				<span class="s1">&#39;dialog&#39;</span>	<span class="o">:</span> <span class="nx">_onBeforeDialog</span>
			<span class="p">};</span>

	<span class="c1">// a collection of new script tags which will be added after the response is done to preserve the execution order</span>
		<span class="kd">var</span> <span class="nx">_scriptTags</span> <span class="o">=</span> <span class="p">[];</span>

	<span class="c1">// a collection of responses used for the &#39;tdi:ajax:done&#39; event</span>
		<span class="kd">var</span> <span class="nx">_responses</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">updates</span> <span class="o">:</span> <span class="p">[],</span>
			<span class="nx">inserts</span> <span class="o">:</span> <span class="p">[],</span>
			<span class="nx">scripts</span> <span class="o">:</span> <span class="p">[],</span>
			<span class="nx">styles</span> <span class="o">:</span> <span class="p">[],</span>
			<span class="nx">popups</span> <span class="o">:</span> <span class="p">[],</span>
			<span class="nx">messages</span> <span class="o">:</span> <span class="p">[],</span>
			<span class="nx">dialogs</span> <span class="o">:</span> <span class="p">[]</span>
		<span class="p">};</span>

	<span class="c1">// CALLBACKS -----------------------------------------------------------------</span>
		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The default &lt;em&gt;start&lt;/em&gt; callback.&lt;/p&gt;</span>
<span class="cm">		 * @method _start</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {jqXHR} xhr The jqXHR object</span>
<span class="cm">		 * @param {Object} settings The Ajax settings</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_start</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="c1">// xhr.setRequestHeader( &#39;X-Requested-Format&#39;, &#39;xml&#39; );</span>
			<span class="cm">/**</span>
<span class="cm">			 * &lt;p&gt;Fires when the TDI request has started.&lt;/p&gt;</span>
<span class="cm">			 * @event tdi:ajax:start</span>
<span class="cm">			 * @param {Event} evt The event object</span>
<span class="cm">			 * @param {Object} data The event data:</span>
<span class="cm">			 *   &lt;dl&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">			 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;/dl&gt;</span>
<span class="cm">			 */</span>
			<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:start&#39;</span><span class="p">,</span> <span class="p">[{</span>
				<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
			<span class="p">}]</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The default &lt;em&gt;success&lt;/em&gt; callback.&lt;/p&gt;</span>
<span class="cm">		 * @method _success</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {jQuery} xml The response XML document</span>
<span class="cm">		 * @param {String} textStatus The status of the response</span>
<span class="cm">		 * @param {jqXHR} xhr The jqXHR object</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_success</span><span class="p">(</span> <span class="nx">xml</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">xml</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">_error</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
				<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$xml</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">xml</span><span class="p">),</span>
				<span class="nx">status</span> <span class="o">=</span> <span class="nx">$xml</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s1">&#39;status&#39;</span> <span class="p">),</span>
				<span class="nx">infusionInstructionsNames</span> <span class="o">=</span> <span class="p">[];</span>

			<span class="c1">// check for status</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">status</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;ok&#39;</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">_error</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">status</span><span class="p">.</span><span class="nx">text</span><span class="p">(),</span> <span class="nx">options</span> <span class="p">);</span>
				<span class="p">}</span>

			<span class="c1">// handle tags</span>
				<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="nx">_infusionInstructions</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">infusionInstructionsNames</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">key</span> <span class="p">);</span>
				<span class="p">}</span> <span class="p">);</span>
				<span class="nx">$xml</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="nx">infusionInstructionsNames</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="p">)</span> <span class="p">).</span><span class="nx">each</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">instruction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

					<span class="k">switch</span><span class="p">(</span> <span class="nx">instruction</span> <span class="p">)</span> <span class="p">{</span>
						<span class="k">case</span> <span class="s1">&#39;Script&#39;</span><span class="o">:</span>
								<span class="c1">// collect all script tags to a list, so they can be downloaded and executed in the preserved order</span>
								<span class="nx">_scriptTags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="k">default</span><span class="o">:</span>
								<span class="nx">_infusionInstructions</span><span class="p">[</span> <span class="nx">instruction</span> <span class="p">](</span> <span class="k">this</span><span class="p">,</span> <span class="nx">options</span> <span class="p">);</span>
							<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="p">);</span>

				<span class="c1">// download and execute the list of script tags</span>
					<span class="nx">_onBeforeScript</span><span class="p">(</span> <span class="nx">_scriptTags</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="nx">options</span> <span class="p">);</span>

				<span class="c1">// fire the custom ajax:done events</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI &amp;lt;update&amp;gt;s are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:updatesDone</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;updates&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all updates&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:updatesDone&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">updates</span> <span class="o">:</span> <span class="nx">_responses</span><span class="p">.</span><span class="nx">updates</span><span class="p">,</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
					<span class="p">}]</span> <span class="p">);</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI &amp;lt;insert&amp;gt;s are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:insertsDone</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;inserts&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all inserts&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:insertsDone&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">inserts</span> <span class="o">:</span> <span class="nx">_responses</span><span class="p">.</span><span class="nx">inserts</span><span class="p">,</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
					<span class="p">}]</span> <span class="p">);</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI &amp;lt;script&amp;gt;s are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:scriptsDone</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;scripts&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all scripts&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:scriptsDone&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">scripts</span> <span class="o">:</span> <span class="nx">_responses</span><span class="p">.</span><span class="nx">scripts</span><span class="p">,</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
					<span class="p">}]</span> <span class="p">);</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI &amp;lt;style&amp;gt;s are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:stylesDone</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;styles&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all styles&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:stylesDone&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">styles</span> <span class="o">:</span> <span class="nx">_responses</span><span class="p">.</span><span class="nx">styles</span><span class="p">,</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
					<span class="p">}]</span> <span class="p">);</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI &amp;lt;popup&amp;gt;s are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:popupsDone</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;popups&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all popups&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:popupsDone&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">popups</span> <span class="o">:</span> <span class="nx">_responses</span><span class="p">.</span><span class="nx">popups</span><span class="p">,</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
					<span class="p">}]</span> <span class="p">);</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI &amp;lt;message&amp;gt;s are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:messagesDone</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;messages&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all messages&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:messagesDone&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">messages</span> <span class="o">:</span> <span class="nx">_responses</span><span class="p">.</span><span class="nx">messages</span><span class="p">,</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
					<span class="p">}]</span> <span class="p">);</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI &amp;lt;dialog&amp;gt;s are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:dialogsDone</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;dialogs&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all dialogs&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:dialogsDone&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">dialogs</span> <span class="o">:</span> <span class="nx">_responses</span><span class="p">.</span><span class="nx">dialogs</span><span class="p">,</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
					<span class="p">}]</span> <span class="p">);</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires when all TDI actions are done.&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:done</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;responses&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The list of all TDI actions&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:done&#39;</span><span class="p">,</span> <span class="p">[{</span>
						<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span><span class="p">,</span>
						<span class="nx">responses</span> <span class="o">:</span> <span class="nx">_responses</span>
					<span class="p">}]</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The default &lt;em&gt;error&lt;/em&gt; callback.&lt;/p&gt;</span>
<span class="cm">		 * @method _error</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {jqXHR} xhr The jqXHR object</span>
<span class="cm">		 * @param {String} textStatus The status of the response</span>
<span class="cm">		 * @param {String} error The error message</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_error</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**</span>
<span class="cm">			 * &lt;p&gt;Fires when the Ajax request ends with an error.&lt;/p&gt;</span>
<span class="cm">			 * @event tdi:ajax:error</span>
<span class="cm">			 * @param {Event} evt The event object</span>
<span class="cm">			 * @param {Object} data The event data:</span>
<span class="cm">			 *   &lt;dl&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;status&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">			 *       &lt;span&gt;The XHR status text (if available)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;message&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">			 *       &lt;span&gt;The error message&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;/dl&gt;</span>
<span class="cm">			 */</span>
			<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:error&#39;</span><span class="p">,</span> <span class="p">[{</span>
				<span class="nx">status</span> <span class="o">:</span> <span class="nx">xhr</span> <span class="o">?</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span>
				<span class="nx">message</span> <span class="o">:</span> <span class="nx">error</span> <span class="o">||</span> <span class="s1">&#39;Invalid Ajax response. The response must be a valid XML.&#39;</span><span class="p">,</span>
				<span class="nx">xhr</span> <span class="o">:</span> <span class="nx">xhr</span><span class="p">,</span>
				<span class="nx">textStatus</span> <span class="o">:</span> <span class="nx">textStatus</span><span class="p">,</span>
				<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
			<span class="p">}]</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The default &lt;em&gt;end&lt;/em&gt; callback.&lt;/p&gt;</span>
<span class="cm">		 * @method _end</span>
<span class="cm">		 * @private</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_end</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**</span>
<span class="cm">			 * &lt;p&gt;Fires when the TDI request has ended.&lt;/p&gt;</span>
<span class="cm">			 * @event tdi:ajax:end</span>
<span class="cm">			 * @param {Event} evt The event object</span>
<span class="cm">			 * @param {Object} data The event data:</span>
<span class="cm">			 *   &lt;dl&gt;</span>
<span class="cm">			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">			 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">			 *   &lt;/dl&gt;</span>
<span class="cm">			 */</span>
			<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:end&#39;</span><span class="p">,</span> <span class="p">[{</span>
				<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
			<span class="p">}]</span> <span class="p">);</span>
		<span class="p">}</span>

	<span class="c1">// RESPONSES -----------------------------------------------------------------</span>
		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforeUpdate callback. It takes the &amp;lt;update&amp;gt; xml node, gets its data and triggers a custom event which</span>
<span class="cm">		 * can stop the default update action.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeUpdate</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;update&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeUpdate</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">target_id</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;target&#39;</span> <span class="p">),</span>
				<span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;target&#39;</span> <span class="p">)</span> <span class="p">),</span>
				<span class="nx">content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span> <span class="p">),</span>
				<span class="nx">replace</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;replace&#39;</span> <span class="p">),</span>
				<span class="nx">append</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;append&#39;</span> <span class="p">),</span>
				<span class="nx">prepend</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;prepend&#39;</span> <span class="p">),</span>
				<span class="nx">class_add</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;class-add&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
				<span class="nx">class_remove</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;class-remove&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
				<span class="nx">event_data</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">target_id</span>		<span class="o">:</span> <span class="nx">target_id</span><span class="p">,</span>
					<span class="nx">target</span>			<span class="o">:</span> <span class="nx">target</span><span class="p">,</span>
					<span class="nx">content</span>			<span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
					<span class="nx">content_empty</span>	<span class="o">:</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/\&amp;nbsp;/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">),</span>
					<span class="nx">replace</span>			<span class="o">:</span> <span class="nx">replace</span><span class="p">,</span>
					<span class="nx">append</span>			<span class="o">:</span> <span class="nx">append</span><span class="p">,</span>
					<span class="nx">prepend</span>			<span class="o">:</span> <span class="nx">prepend</span><span class="p">,</span>
					<span class="nx">class_add</span>		<span class="o">:</span> <span class="nx">class_add</span><span class="p">,</span>
					<span class="nx">class_remove</span>	<span class="o">:</span> <span class="nx">class_remove</span><span class="p">,</span>
					<span class="nx">options</span>			<span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">target</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="c1">// fire custom events</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires before the TDI &lt;em&gt;update&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onUpdateDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:beforeUpdate</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The update contents&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content_empty&lt;/span&gt; &lt;span&gt;&amp;lt;Boolean&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Indicates whether the contents are empty&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;replace&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Indicates whether the contents will replace the whole target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;append&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Indicates whether the contents will be appended to the end of the target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;prepend&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Indicates whether the contents will be prepended to the beginning of the target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_add&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Space separated list of class names to add&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_remove&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Space separates list of class names to remove&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">target</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeUpdate&#39;</span><span class="p">,</span> <span class="nx">event_data</span> <span class="p">);</span>

					<span class="nx">_responses</span><span class="p">.</span><span class="nx">updates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">event_data</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforeInsert callback. It takes the &amp;lt;insert&amp;gt; xml node, gets its data and triggers a custom event which</span>
<span class="cm">		 * can stop the default insert action.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeInsert</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;insert&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeInsert</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">target_id</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;target&#39;</span> <span class="p">),</span>
				<span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">target_id</span> <span class="p">),</span>
				<span class="nx">content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span> <span class="p">),</span>
				<span class="nx">position</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;position&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;after&#39;</span><span class="p">,</span>
				<span class="nx">inserted_node</span><span class="p">,</span>
				<span class="nx">event_data</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">target_id</span>		<span class="o">:</span> <span class="nx">target_id</span><span class="p">,</span>
					<span class="nx">target</span>			<span class="o">:</span> <span class="nx">target</span><span class="p">,</span>
					<span class="nx">content</span>			<span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
					<span class="nx">position</span>		<span class="o">:</span> <span class="nx">position</span><span class="p">,</span>
					<span class="nx">inserted_node</span>	<span class="o">:</span> <span class="nx">inserted_node</span><span class="p">,</span>
					<span class="nx">options</span>			<span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">target</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="c1">// fire custom events</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires before the TDI &lt;em&gt;insert&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onInsertDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:beforeInsert</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The contents&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;position&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The position of the insert (before|after)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">target</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeInsert&#39;</span><span class="p">,</span> <span class="nx">event_data</span> <span class="p">);</span>

					<span class="nx">_responses</span><span class="p">.</span><span class="nx">inserts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">event_data</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforeScript callback. It takes the &amp;lt;script&amp;gt; xml node, gets its data and triggers a custom event which</span>
<span class="cm">		 * can stop the default script action.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeScript</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;script&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeScript</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">contents</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span> <span class="p">),</span>
				<span class="nx">src</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;src&#39;</span> <span class="p">),</span>
				<span class="nx">id</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;id&#39;</span> <span class="p">),</span>
				<span class="nx">event_data</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">script_src</span>	<span class="o">:</span> <span class="nx">src</span><span class="p">,</span>
					<span class="nx">script_data</span>	<span class="o">:</span> <span class="nx">contents</span><span class="p">,</span>
					<span class="nx">script_id</span>	<span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
					<span class="nx">options</span>		<span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>

			<span class="c1">// fire custom events</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires before the TDI &lt;em&gt;script&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onScriptDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:beforeScript</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Path to the external Javascript file&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_data&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Inline Javascript code&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;ID of the &amp;lt;script&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeScript&#39;</span><span class="p">,</span> <span class="nx">event_data</span> <span class="p">);</span>

				<span class="nx">_responses</span><span class="p">.</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">event_data</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforeStyle callback. It takes the &amp;lt;style&amp;gt; xml node, gets its data and triggers a custom event which</span>
<span class="cm">		 * can stop the default style action.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeStyle</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;style&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeStyle</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">src</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;src&#39;</span> <span class="p">),</span>
				<span class="nx">id</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;id&#39;</span> <span class="p">),</span>
				<span class="nx">event_data</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">style_src</span>	<span class="o">:</span> <span class="nx">src</span><span class="p">,</span>
					<span class="nx">style_id</span>	<span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
					<span class="nx">options</span>		<span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>

			<span class="c1">// fire custom events</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires before the TDI &lt;em&gt;style&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onStyleDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:beforeStyle</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Path to the external CSS file&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;ID of the &amp;lt;link&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeStyle&#39;</span><span class="p">,</span> <span class="nx">event_data</span> <span class="p">);</span>

				<span class="nx">_responses</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">event_data</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforeReload callback. It just reloads the page.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeReload</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;reload&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeReload</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="c1">// fire custom events</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires before the TDI &lt;em&gt;reload&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onReloadDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:beforeReload</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeReload&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span><span class="p">}</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The before redirect callback. It takes the &amp;lt;redirect&amp;gt; xml node, gets its data and redirects</span>
<span class="cm">		 * the page to the given URL.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeRedirect</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;redirect&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeRedirect</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">href</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;href&#39;</span> <span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">href</span> <span class="p">)</span> <span class="p">{</span>
				<span class="c1">// fire custom events</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires before the TDI &lt;em&gt;redirect&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onRedirectDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:beforeRedirect</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The URL to redirect to&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeRedirect&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">href</span> <span class="o">:</span> <span class="nx">href</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span> <span class="p">}</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforePopup callback. It takes the &amp;lt;popup&amp;gt; xml node, gets its data and triggers a custom event which</span>
<span class="cm">		 * can stop the default popup action.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforePopup</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;popup&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforePopup</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">mode</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;mode&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;popup&#39;</span><span class="p">,</span>
				<span class="nx">href</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;href&#39;</span> <span class="p">),</span>
				<span class="nx">width</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;width&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="mi">600</span><span class="p">,</span>
				<span class="nx">height</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;height&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="mi">500</span><span class="p">,</span>
				<span class="nx">event_data</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">href</span>	<span class="o">:</span> <span class="nx">href</span><span class="p">,</span>
					<span class="nx">mode</span>	<span class="o">:</span> <span class="nx">mode</span><span class="p">,</span>
					<span class="nx">width</span>	<span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">width</span><span class="p">),</span>
					<span class="nx">height</span>	<span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">height</span><span class="p">),</span>
					<span class="nx">options</span>	<span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">href</span> <span class="p">)</span> <span class="p">{</span>
				<span class="c1">// fire custom events</span>
					<span class="cm">/**</span>
<span class="cm">					 * &lt;p&gt;Fires before the TDI &lt;em&gt;popup&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onPopupDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">					 * @event tdi:ajax:beforePopup</span>
<span class="cm">					 * @param {Event} evt The event object</span>
<span class="cm">					 * @param {Object} data The event data:</span>
<span class="cm">					 *   &lt;dl&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The URL of the popup&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;mode&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;The mode of the popup (popup|dialog)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Width of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">					 *       &lt;span&gt;Height of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">					 *   &lt;/dl&gt;</span>
<span class="cm">					 */</span>
					<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforePopup&#39;</span><span class="p">,</span> <span class="nx">event_data</span> <span class="p">);</span>
					<span class="nx">_responses</span><span class="p">.</span><span class="nx">popups</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">event_data</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforeMessage callback. It takes the &amp;lt;message&amp;gt; xml node, gets its data and triggers a custom event which</span>
<span class="cm">		 * can stop the default message action.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeMessage</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;message&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeMessage</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">severity</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;severity&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
				<span class="nx">title</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;title&#39;</span> <span class="p">),</span>
				<span class="nx">contents</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span> <span class="p">),</span>
				<span class="nx">event_data</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">severity</span>	<span class="o">:</span> <span class="nx">severity</span><span class="p">,</span>
					<span class="nx">title</span>		<span class="o">:</span> <span class="nx">title</span><span class="p">,</span>
					<span class="nx">contents</span>	<span class="o">:</span> <span class="nx">contents</span><span class="p">,</span>
					<span class="nx">options</span>		<span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>

			<span class="c1">// fire custom events</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires before the TDI &lt;em&gt;message&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onMessageDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:beforeMessage</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;severity&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Severity of the message (defaults to INFO)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;title&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Optional title of the message&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Message text&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeMessage&#39;</span><span class="p">,</span> <span class="nx">event_data</span> <span class="p">);</span>
				<span class="nx">_responses</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">event_data</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The beforeDialog callback. It takes the &amp;lt;dialog&amp;gt; xml node, gets its data and triggers a custom event which</span>
<span class="cm">		 * can stop the default dialog action.&lt;/p&gt;</span>
<span class="cm">		 *</span>
<span class="cm">		 * @method _onBeforeDialog</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {XMLNode} tag The &amp;lt;dialog&amp;gt; xml tag</span>
<span class="cm">		 * @param {Object} options Additional request options</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onBeforeDialog</span><span class="p">(</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">options</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">tag</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">$tag</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
				<span class="nx">contents</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span> <span class="p">),</span>
				<span class="nx">action</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;action&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span>
				<span class="nx">id</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;id&#39;</span> <span class="p">),</span>
				<span class="nx">cancelUrl</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;cancel-url&#39;</span> <span class="p">),</span>
				<span class="nx">width</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;width&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
				<span class="nx">height</span> <span class="o">=</span> <span class="nx">$tag</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="s1">&#39;height&#39;</span> <span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
				<span class="nx">event_data</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">contents</span>	<span class="o">:</span> <span class="nx">contents</span><span class="p">,</span>
					<span class="nx">action</span>		<span class="o">:</span> <span class="nx">action</span><span class="p">,</span>
					<span class="nx">id</span>			<span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
					<span class="nx">cancelUrl</span>	<span class="o">:</span> <span class="nx">cancelUrl</span><span class="p">,</span>
					<span class="nx">width</span>		<span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">width</span><span class="p">),</span>
					<span class="nx">height</span>		<span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">height</span><span class="p">),</span>
					<span class="nx">options</span>		<span class="o">:</span> <span class="nx">options</span>
				<span class="p">};</span>

			<span class="c1">// fire custom events</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires before the TDI &lt;em&gt;dialog&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onDialogDefault&lt;/code&gt;).&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:beforeDialog</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Dialog contents&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;action&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;What to do with the dialog (defaults to `open`)&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The dialogs identifier. Used for closing when multiple dialogs are opened at once.&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;cancel-url&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;An optional cancel URL. Can be used to close the Dialog with ESC and other UI options.&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Optional width of the Dialog.&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Optional height of the Dialog.&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:beforeDialog&#39;</span><span class="p">,</span> <span class="nx">event_data</span> <span class="p">);</span>
				<span class="nx">_responses</span><span class="p">.</span><span class="nx">dialogs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">event_data</span> <span class="p">);</span>
		<span class="p">}</span>

	<span class="c1">// RESPONSES DEFAULTS</span>
		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The update default response handler. Updates the specified target with new contents.&lt;/p&gt;</span>
<span class="cm">		 * @method _onUpdateDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The update data object:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;The ID of the target element&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;The target element&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;The new HTML contents&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;replace&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;(&quot;true&quot;|&quot;false&quot;) Whether to update the targets contents, or to replace the whole target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;append&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;(&quot;true&quot;|&quot;false&quot;) Whether to append the new contents at the end of the target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;prepend&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;(&quot;true&quot;|&quot;false&quot;) Whether to prepend the new contents at the begining of the target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_add&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;CSS class name(s) which will be added to the target. Multiple class names are separated by a space&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_remove&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;CSS class name(s) which will be added to the target. Multiple class names are separated by a space&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *    &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onUpdateDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="c1">// classes</span>
				<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">class_remove</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">class_add</span> <span class="p">);</span>

			<span class="c1">// update the target element</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">replace</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s1">&#39;*&#39;</span> <span class="p">).</span><span class="nx">andSelf</span><span class="p">().</span><span class="nx">unbind</span><span class="p">();</span> <span class="c1">// detach all event handlers from the target and its child nodes</span>
					<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">content</span> <span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">append</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">content</span> <span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">prepend</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">content</span> <span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s1">&#39;*&#39;</span> <span class="p">).</span><span class="nx">unbind</span><span class="p">();</span> <span class="c1">// detach all event handlers from the targets child nodes</span>
					<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">content</span> <span class="p">);</span>
				<span class="p">}</span>

			<span class="c1">// trigger the update event</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires after the TDI &lt;em&gt;update&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:update</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The update contents&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content_empty&lt;/span&gt; &lt;span&gt;&amp;lt;Boolean&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Indicates whether the contents are empty&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;replace&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Indicates whether the contents will replace the whole target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;append&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Indicates whether the contents will be appended to the end of the target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;prepend&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Indicates whether the contents will be prepended to the beginning of the target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_add&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Space separated list of class names to add&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_remove&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Space separates list of class names to remove&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:update&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The insert default response handler. Inserts the contents before/after the target.&lt;/p&gt;</span>
<span class="cm">		 * @method _onInsertDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The insert data object:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;The ID of the target element&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;The target element&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;The new HTML contents&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;position&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;(&quot;before&quot;|&quot;after&quot;) Whether to insert the contents before, or after the target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onInsertDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">data</span><span class="p">.</span><span class="nx">inserted_node</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">content</span> <span class="p">)[</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">position</span> <span class="o">===</span> <span class="s1">&#39;before&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;insertBefore&#39;</span> <span class="o">:</span> <span class="s1">&#39;insertAfter&#39;</span> <span class="p">](</span> <span class="nx">data</span><span class="p">.</span><span class="nx">target</span> <span class="p">);</span>

			<span class="c1">// trigger the insert event</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires after the TDI &lt;em&gt;insert&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:insert</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The contents&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;position&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The position of the insert (before|after)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;inserted_node&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; Reference to the inserted HTML node&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">data</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:insert&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The script default response handler. Loads and executes new scripts.&lt;/p&gt;</span>
<span class="cm">		 * @method _onScriptDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The script data object:</span>
<span class="cm">		 * &lt;dl&gt;</span>
<span class="cm">		 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *     &lt;span&gt;URL of the new external script&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_data&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *     &lt;span&gt;Inline script data&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *     &lt;span&gt;ID of the &amp;lt;script&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 * &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onScriptDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="nx">_scriptTags</span><span class="p">,</span>
				<span class="nx">download</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
				<span class="nx">onComplete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">node</span> <span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">s</span><span class="p">;</span>

					<span class="c1">// execute inline script</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_data</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span> <span class="s1">&#39;script&#39;</span> <span class="p">);</span>
						<span class="nx">s</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span>
						<span class="nx">s</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_data</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_id</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">s</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_id</span> <span class="o">+</span> <span class="s1">&#39;_inline&#39;</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
					<span class="p">}</span>

					<span class="c1">// trigger the script event</span>
						<span class="nx">data</span><span class="p">.</span><span class="nx">script_node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
						<span class="cm">/**</span>
<span class="cm">						 * &lt;p&gt;Fires after the TDI &lt;em&gt;script&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">						 * @event tdi:ajax:script</span>
<span class="cm">						 * @param {Event} evt The event object</span>
<span class="cm">						 * @param {Object} data The event data:</span>
<span class="cm">						 *   &lt;dl&gt;</span>
<span class="cm">						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">						 *       &lt;span&gt;Path to the external Javascript file&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_data&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">						 *       &lt;span&gt;Inline Javascript code&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">						 *       &lt;span&gt;ID of the &amp;lt;script&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_node&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">						 *       &lt;span&gt;Reference to the inserted &amp;lt;script&amp;gt; node&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">						 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">						 *   &lt;/dl&gt;</span>
<span class="cm">						 */</span>
						<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:script&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>

					<span class="c1">// process next script</span>
						<span class="nx">_onBeforeScript</span><span class="p">(</span> <span class="nx">scripts</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span> <span class="p">);</span>
				<span class="p">};</span>

			<span class="c1">// if there is an &#39;src&#39; attribute, load the script first and when fully loaded, execute the script contents</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_src</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_id</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">script_id</span> <span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">download</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">download</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">TDI</span><span class="p">.</span><span class="nx">Tools</span><span class="p">.</span><span class="nx">getScript</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_src</span><span class="p">,</span> <span class="p">{</span>
							<span class="nx">id</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">script_id</span><span class="p">,</span>
							<span class="nx">complete</span> <span class="o">:</span> <span class="nx">onComplete</span>
						<span class="p">}</span> <span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">onComplete</span><span class="p">();</span>
				<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The style default response handler. Loads external stylesheets.&lt;/p&gt;</span>
<span class="cm">		 * @method _onStyleDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The style data object:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;URL of the new external stylesheet&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;ID of the &amp;lt;link&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onStyleDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">download</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">style_id</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">style_id</span> <span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">download</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">download</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">TDI</span><span class="p">.</span><span class="nx">Tools</span><span class="p">.</span><span class="nx">getStyle</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">style_src</span><span class="p">,</span> <span class="p">{</span>
					<span class="nx">id</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">style_id</span><span class="p">,</span>
					<span class="nx">complete</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">node</span> <span class="p">)</span> <span class="p">{</span>
						<span class="c1">// trigger the style event</span>
							<span class="nx">data</span><span class="p">.</span><span class="nx">style_node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
							<span class="cm">/**</span>
<span class="cm">							 * &lt;p&gt;Fires after the TDI &lt;em&gt;style&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">							 * @event tdi:ajax:style</span>
<span class="cm">							 * @param {Event} evt The event object</span>
<span class="cm">							 * @param {Object} data The event data:</span>
<span class="cm">							 *   &lt;dl&gt;</span>
<span class="cm">							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">							 *       &lt;span&gt;Path to the external CSS file&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">							 *       &lt;span&gt;ID of the &amp;lt;link&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_node&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">							 *       &lt;span&gt;Reference to the inserted &amp;lt;link&amp;gt; node&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">							 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">							 *   &lt;/dl&gt;</span>
<span class="cm">							 */</span>
							<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:style&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The reload default response handler. Reloads the page.&lt;/p&gt;</span>
<span class="cm">		 * @method _onReloadDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} data The reload data object</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onReloadDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">(</span> <span class="kc">true</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The redirect default response handler. Redirects the page to a given URL.&lt;/p&gt;</span>
<span class="cm">		 * @method _onRedirectDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The redirect data object:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;URL of the redirect&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onRedirectDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">href</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The popup default response handler.&lt;/p&gt;</span>
<span class="cm">		 * @method _onPopupDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The popup data object:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Target URL of the popup&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;mode&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;(&quot;popup&quot;|&quot;dialog&quot;) The type of the popup&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Width of the popup in mode &quot;dialog&quot;&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Height of the popup in mode &quot;dialog&quot;&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onPopupDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
				<span class="nx">popup</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">mode</span> <span class="o">===</span> <span class="s1">&#39;dialog&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">params</span> <span class="o">+=</span> <span class="s1">&#39;width=&#39;</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">width</span><span class="o">+</span><span class="s1">&#39;, height=&#39;</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="nx">data</span><span class="p">.</span><span class="nx">popup</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span> <span class="s1">&#39;_blank&#39;</span><span class="p">,</span> <span class="nx">params</span> <span class="p">);</span>

			<span class="c1">// trigger the popup event</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires after the TDI &lt;em&gt;popup&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:popup</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The URL of the popup&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;mode&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The mode of the popup (popup|dialog)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Width of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Height of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;popup&lt;/span&gt; &lt;span&gt;&amp;lt;window&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Reference to the opened &lt;em&gt;window&lt;/em&gt;&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:popup&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The message default response handler.&lt;/p&gt;</span>
<span class="cm">		 * @method _onMessageDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The popup data object:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;severity&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Severity of the message (defaults to INFO)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;title&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Optional title of the message&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Message text&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onMessageDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">severity</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">message</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">contents</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">message</span> <span class="o">+=</span> <span class="s1">&#39;\n\n&#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">contents</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="c1">// trigger the message event</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires after the TDI &lt;em&gt;message&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:message</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;severity&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Severity of the message (defaults to INFO)&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;title&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Optional title of the message&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Message text&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:message&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/**</span>
<span class="cm">		 * &lt;p&gt;The dialog default response handler.&lt;/p&gt;</span>
<span class="cm">		 * @method _onDialogDefault</span>
<span class="cm">		 * @private</span>
<span class="cm">		 * @param {Object} evt The event object</span>
<span class="cm">		 * @param {Object} data The dialog data object:</span>
<span class="cm">		 *   &lt;dl&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Dialog contents&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">		 *   &lt;/dl&gt;</span>
<span class="cm">		 */</span>
		<span class="kd">function</span> <span class="nx">_onDialogDefault</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
			<span class="c1">// trigger the dialog event</span>
				<span class="cm">/**</span>
<span class="cm">				 * &lt;p&gt;Fires after the TDI &lt;em&gt;dialog&lt;/em&gt; takes place.&lt;/p&gt;</span>
<span class="cm">				 * @event tdi:ajax:dialog</span>
<span class="cm">				 * @param {Event} evt The event object</span>
<span class="cm">				 * @param {Object} data The event data:</span>
<span class="cm">				 *   &lt;dl&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Dialog contents&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;action&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;What to do with the dialog (defaults to `open`)&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;The dialogs identifier. Used for closing when multiple dialogs are opened at once.&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;cancel-url&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;An optional cancel URL. Can be used to close the Dialog with ESC and other UI options.&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Optional width of the Dialog.&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Optional height of the Dialog.&lt;/dd&gt;</span>
<span class="cm">				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;</span>
<span class="cm">				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;</span>
<span class="cm">				 *   &lt;/dl&gt;</span>
<span class="cm">				 */</span>
				<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">&#39;tdi:ajax:dialog&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">);</span>
		<span class="p">}</span>

	<span class="c1">// TDI Ajax custom events -------------------------------------------------</span>
		<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
			<span class="nx">customHandlers</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s1">&#39;tdi:ajax:beforeUpdate&#39;</span>		<span class="o">:</span> <span class="nx">_onUpdateDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforeInsert&#39;</span>		<span class="o">:</span> <span class="nx">_onInsertDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforeScript&#39;</span>		<span class="o">:</span> <span class="nx">_onScriptDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforeStyle&#39;</span>		<span class="o">:</span> <span class="nx">_onStyleDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforeReload&#39;</span>		<span class="o">:</span> <span class="nx">_onReloadDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforeRedirect&#39;</span>	<span class="o">:</span> <span class="nx">_onRedirectDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforePopup&#39;</span>		<span class="o">:</span> <span class="nx">_onPopupDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforeMessage&#39;</span>	<span class="o">:</span> <span class="nx">_onMessageDefault</span><span class="p">,</span>
				<span class="s1">&#39;tdi:ajax:beforeDialog&#39;</span>		<span class="o">:</span> <span class="nx">_onDialogDefault</span>
			<span class="p">},</span>
			<span class="nx">customDefault</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">customHandlers</span><span class="p">[</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">type</span> <span class="p">].</span><span class="nx">call</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">?</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="nx">data</span><span class="p">)</span> <span class="p">);</span>
			<span class="p">};</span>

		<span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">customHandlers</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">special</span><span class="p">[</span> <span class="nx">i</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">_default</span> <span class="o">:</span> <span class="nx">customDefault</span>
			<span class="p">};</span>
		<span class="p">}</span>

	<span class="c1">// PUBLIC STUFF</span>
		<span class="k">return</span> <span class="p">{};</span>

<span class="p">}(</span><span class="nx">jQuery</span><span class="p">);</span>
</pre></div>
                    </div>
			</div>
		</div>
		<div class="yui-b">
            <div class="nav">

                    <div id="moduleList" class="module">
                        <h4>Modules</h4>
                        <ul class="content">
                                <li class="selected"><a href="module_TDI.html" title="TDI">TDI</a></li>
                        </ul>
                    </div>

                    <div id="classList" class="module">
                        <h4>Classes</h4>
                        <ul class="content">
                                <li class=""><a href="TDI.Ajax.html" title="TDI.Ajax">TDI.Ajax</a></li>
                                <li class=""><a href="TDI.Ajax.Request.html" title="TDI.Ajax.Request">TDI.Ajax.Request</a></li>
                                <li class=""><a href="TDI.Ajax.Response.html" title="TDI.Ajax.Response">TDI.Ajax.Response</a></li>
                                <li class=""><a href="TDI.Tools.html" title="TDI.Tools">TDI.Tools</a></li>
                        </ul>
                    </div>

                    <div id="fileList" class="module">
                        <h4>Files</h4>
                        <ul class="content">        
                                <li class="selected"><a href="tdi-ajax.js.html" title="tdi-ajax.js">tdi-ajax.js</a></li>
                                <li class=""><a href="tdi-tools.js.html" title="tdi-tools.js">tdi-tools.js</a></li>
                                <li class=""><a href="tdi.js.html" title="tdi.js">tdi.js</a></li>
                        </ul>
                    </div>





            </div>
		</div>
	</div>
	<div id="ft">
        <hr />
        Copyright &copy; 2013 Yahoo! Inc. All rights reserved.
	</div>
</div>
<script type="text/javascript">
    ALL_YUI_PROPS = [{"url": "TDI.Ajax.Request.html#method_ajaxifyUrl", "access": "", "host": "TDI.Ajax.Request", "type": "method", "name": "ajaxifyUrl"}, {"url": "TDI.Ajax.html#method__bindUI", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_bindUI"}, {"url": "TDI.Tools.html#method__checkDependencies", "access": "private", "host": "TDI.Tools", "type": "method", "name": "_checkDependencies"}, {"url": "TDI.Ajax.html#property__delegateSelectors", "access": "private", "host": "TDI.Ajax", "type": "property", "name": "_delegateSelectors"}, {"url": "TDI.Ajax.Response.html#method__end", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_end"}, {"url": "TDI.Ajax.Response.html#method__error", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_error"}, {"url": "TDI.Tools.html#method_getScript", "access": "", "host": "TDI.Tools", "type": "method", "name": "getScript"}, {"url": "TDI.Tools.html#method_getStyle", "access": "", "host": "TDI.Tools", "type": "method", "name": "getStyle"}, {"url": "TDI.Tools.html#property__jQueryMinVersion", "access": "private", "host": "TDI.Tools", "type": "property", "name": "_jQueryMinVersion"}, {"url": "TDI.Ajax.Response.html#method__onBeforeDialog", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeDialog"}, {"url": "TDI.Ajax.html#method__onBeforeFormSubmit", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_onBeforeFormSubmit"}, {"url": "TDI.Ajax.Response.html#method__onBeforeInsert", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeInsert"}, {"url": "TDI.Ajax.html#method__onBeforeLinkClick", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_onBeforeLinkClick"}, {"url": "TDI.Ajax.Response.html#method__onBeforeMessage", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeMessage"}, {"url": "TDI.Ajax.Response.html#method__onBeforePopup", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforePopup"}, {"url": "TDI.Ajax.Response.html#method__onBeforeRedirect", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeRedirect"}, {"url": "TDI.Ajax.Response.html#method__onBeforeReload", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeReload"}, {"url": "TDI.Ajax.Response.html#method__onBeforeScript", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeScript"}, {"url": "TDI.Ajax.Response.html#method__onBeforeStyle", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeStyle"}, {"url": "TDI.Ajax.Response.html#method__onBeforeUpdate", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onBeforeUpdate"}, {"url": "TDI.Ajax.Response.html#method__onDialogDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onDialogDefault"}, {"url": "TDI.Ajax.html#method__onFieldChange", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_onFieldChange"}, {"url": "TDI.Ajax.html#method__onFieldSubmit", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_onFieldSubmit"}, {"url": "TDI.Ajax.html#method__onFormButtonActivate", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_onFormButtonActivate"}, {"url": "TDI.Ajax.html#method__onFormSubmit", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_onFormSubmit"}, {"url": "TDI.Ajax.Response.html#method__onInsertDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onInsertDefault"}, {"url": "TDI.Ajax.html#method__onLinkClick", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_onLinkClick"}, {"url": "TDI.Ajax.Response.html#method__onMessageDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onMessageDefault"}, {"url": "TDI.Ajax.Response.html#method__onPopupDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onPopupDefault"}, {"url": "TDI.Ajax.Response.html#method__onRedirectDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onRedirectDefault"}, {"url": "TDI.Ajax.Response.html#method__onReloadDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onReloadDefault"}, {"url": "TDI.Ajax.Response.html#method__onScriptDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onScriptDefault"}, {"url": "TDI.Ajax.Response.html#method__onStyleDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onStyleDefault"}, {"url": "TDI.Ajax.Response.html#method__onUpdateDefault", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_onUpdateDefault"}, {"url": "TDI.Ajax.html#method_send", "access": "", "host": "TDI.Ajax", "type": "method", "name": "send"}, {"url": "TDI.Ajax.Request.html#method_send", "access": "", "host": "TDI.Ajax.Request", "type": "method", "name": "send"}, {"url": "TDI.Ajax.Request.html#method_sendForm", "access": "", "host": "TDI.Ajax.Request", "type": "method", "name": "sendForm"}, {"url": "TDI.Ajax.Response.html#method__start", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_start"}, {"url": "TDI.Ajax.Response.html#method__success", "access": "private", "host": "TDI.Ajax.Response", "type": "method", "name": "_success"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeDialog", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeDialog"}, {"url": "TDI.Ajax.html#event_tdi:ajax:beforeFormSubmit", "access": "", "host": "TDI.Ajax", "type": "event", "name": "tdi:ajax:beforeFormSubmit"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeInsert", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeInsert"}, {"url": "TDI.Ajax.html#event_tdi:ajax:beforeLinkClick", "access": "", "host": "TDI.Ajax", "type": "event", "name": "tdi:ajax:beforeLinkClick"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeMessage", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeMessage"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforePopup", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforePopup"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeRedirect", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeRedirect"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeReload", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeReload"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeScript", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeScript"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeStyle", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeStyle"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:beforeUpdate", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:beforeUpdate"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:dialog", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:dialog"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:dialogsDone", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:dialogsDone"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:done", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:done"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:end", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:end"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:error", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:error"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:insert", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:insert"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:insertsDone", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:insertsDone"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:message", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:message"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:messagesDone", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:messagesDone"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:popup", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:popup"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:popupsDone", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:popupsDone"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:script", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:script"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:scriptsDone", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:scriptsDone"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:start", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:start"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:style", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:style"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:stylesDone", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:stylesDone"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:update", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:update"}, {"url": "TDI.Ajax.Response.html#event_tdi:ajax:updatesDone", "access": "", "host": "TDI.Ajax.Response", "type": "event", "name": "tdi:ajax:updatesDone"}, {"url": "TDI.Ajax.html#method__unbindUI", "access": "private", "host": "TDI.Ajax", "type": "method", "name": "_unbindUI"}];
</script>
</body>
</html>
