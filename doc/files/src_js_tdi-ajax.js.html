<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\tdi-ajax.js - Twinstone TDI</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Twinstone TDI"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.7.7</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/TDI.Ajax.html">TDI.Ajax</a></li>
            
                <li><a href="../classes/TDI.Ajax.Request.html">TDI.Ajax.Request</a></li>
            
                <li><a href="../classes/TDI.Ajax.Response.html">TDI.Ajax.Response</a></li>
            
                <li><a href="../classes/TDI.Tools.html">TDI.Tools</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/TDI.html">TDI</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\js\tdi-ajax.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * Copyright 2013 Etnetera a.s. http://www.etnetera.cz
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * &lt;p&gt;Basic Ajax functionality for the TDI library. Used to bind DOM events to desired HTML elements
 * and send the TDI request when the events fire.&lt;/p&gt;
 * &lt;p&gt;Requires TDI global object.&lt;/p&gt;
 * @class Ajax
 * @namespace TDI
 */
TDI.Ajax = function($) {

	/**
	 * &lt;p&gt;Selectors for ajax enabled elements:&lt;/p&gt;
	 * &lt;ul&gt;
	 *   &lt;li&gt;&lt;code&gt;a.tdi&lt;/code&gt;&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;form.tdi&lt;/code&gt;&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;form.tdi input[type=submit], form.tdi button&lt;/code&gt;&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;select.tdi, input[type=checkbox].tdi, input[type=radio].tdi&lt;/code&gt;&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;input[type=text].tdi&lt;/code&gt;&lt;/li&gt;
	 * &lt;/ul&gt;
	 * @property _delegateSelectors
	 * @private
	 * @final
	 */
	var _delegateSelectors = {
		linkClick			: &#x27;a.ajaxlink, a.tdi, a.infuse&#x27;,
		formSubmit			: &#x27;form.ajaxform, form.tdi, form.infuse&#x27;,
		formButtonActivate	: &#x27;form.ajaxform [type=submit], form.tdi [type=submit], form.infuse [type=submit]&#x27;,
		fieldChange			: &#x27;select.ajaxselect, select.tdi, select.infuse, input[type=checkbox].tdi, input[type=checkbox].infuse, input[type=radio].tdi, input[type=radio].infuse&#x27;,
		fieldSubmit			: &#x27;input[type=text].tdi, input[type=text].infuse&#x27;
	};

	/**
	 * &lt;p&gt;Bind all the needed DOM events for Ajax enabled elements:&lt;/p&gt;
	 * &lt;ul&gt;
	 *   &lt;li&gt;&lt;code&gt;onclick&lt;/code&gt; - ajax enabled links and submit buttons&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;onsubmit&lt;/code&gt; - ajax enabled forms&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;onchange&lt;/code&gt; - ajax enabled form fields&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;onunload&lt;/code&gt; - window&lt;/li&gt;
	 * &lt;/ul&gt;
	 * @method _bindUI
	 * @private
	 */
	function _bindUI() {
		$(document)
			.delegate( _delegateSelectors.formSubmit, &#x27;submit&#x27;, _onBeforeFormSubmit )
			.delegate( _delegateSelectors.linkClick, &#x27;click&#x27;, _onBeforeLinkClick )
			.delegate( _delegateSelectors.formButtonActivate, &#x27;click&#x27;, _onFormButtonActivate )
			.delegate( _delegateSelectors.fieldChange, &#x27;change&#x27;, _onFieldChange )
			.delegate( _delegateSelectors.fieldSubmit, &#x27;keydown&#x27;, _onFieldSubmit );

		$(window).unload( _unbindUI );

		$.event.special[ &#x27;tdi:ajax:beforeLinkClick&#x27; ] = {
			_default : _onLinkClick
		};
		$.event.special[ &#x27;tdi:ajax:beforeFormSubmit&#x27; ] = {
			_default : _onFormSubmit
		};
	}

	/**
	 * &lt;p&gt;Unbind all previously attached DOM event handlers:&lt;/p&gt;
	 * &lt;ul&gt;
	 *   &lt;li&gt;&lt;code&gt;onclick&lt;/code&gt;&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;onsubmit&lt;/code&gt;&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;onchange&lt;/code&gt;&lt;/li&gt;
	 *   &lt;li&gt;&lt;code&gt;onunload&lt;/code&gt;&lt;/li&gt;
	 * &lt;/ul&gt;
	 * @method _unbindUI
	 * @private
	 */
	function _unbindUI( evt ) {
		$(document)
			.undelegate( _delegateSelectors.linkClick, &#x27;click&#x27;, _onLinkClick )
			.undelegate( _delegateSelectors.formSubmit, &#x27;submit&#x27;, _onBeforeFormSubmit )
			.undelegate( _delegateSelectors.formButtonActivate, &#x27;click&#x27;, _onFormButtonActivate )
			.undelegate( _delegateSelectors.fieldChange, &#x27;change&#x27;, _onFieldChange )
			.undelegate( _delegateSelectors.fieldSubmit, &#x27;keydown&#x27;, _onFieldSubmit );
	}

	// EVENT HANDLERS ------------------------------------------------------------
		/**
		 * &lt;p&gt;The link onclick event handler. Used to trigger the preventable &lt;code&gt;tdi:ajax:beforeLinkClick&lt;/code&gt; event.&lt;/p&gt;
		 * @method _onBeforeLinkClick
		 * @private
		 * @param {Event} evt The event object
		 */
		function _onBeforeLinkClick( evt ) {
			evt.preventDefault();

			/**
			 * &lt;p&gt;Fires before the link is clicked (before the link action is executed).&lt;/p&gt;
			 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;_onLinkClick&lt;/code&gt;).&lt;/p&gt;
			 * @event tdi:ajax:beforeLinkClick
			 * @param {Event} evt The event object
			 * @param {Object} data The event data:
			 *   &lt;dl&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;link&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The link object&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;/dl&gt;
			 */
			$(this).trigger( &#x27;tdi:ajax:beforeLinkClick&#x27;, {
				link : $(this)
			} );

			return false;
		}

		/**
		 * &lt;p&gt;The link onclick event handler.&lt;/p&gt;
		 * @method _onLinkClick
		 * @private
		 * @param {Event} evt The event object
		 */
		function _onLinkClick( evt ) {
			TDI.Ajax.send( evt.target );
		}

		/**
		 * &lt;p&gt;The form onsubmit event handler. Used to trigger the preventable &lt;code&gt;tdi:ajax:beforeFormSubmit&lt;/code&gt; event.&lt;/p&gt;
		 * @method _onBeforeFormSubmit
		 * @private
		 * @param {Event} evt The event object
		 */
		function _onBeforeFormSubmit( evt ) {
			evt.preventDefault();

			/**
			 * &lt;p&gt;Fires before the form is submited.&lt;/p&gt;
			 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;_onFormSubmit&lt;/code&gt;).&lt;/p&gt;
			 * @event tdi:ajax:beforeFormSubmit
			 * @param {Event} evt The event object
			 * @param {Object} data The event data:
			 *   &lt;dl&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The form object&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;/dl&gt;
			 */
			$(this).trigger( &#x27;tdi:ajax:beforeFormSubmit&#x27;, {
				form : $(this)
			} );

			return false;
		}

		/**
		 * &lt;p&gt;The form onsubmit event default method.&lt;/p&gt;
		 * @method _onFormSubmit
		 * @private
		 * @param {Event} evt The event object
		 */
		function _onFormSubmit( evt ) {
			TDI.Ajax.send( evt.target );
		}

		/**
		 * &lt;p&gt;Saves the &lt;code&gt;name&lt;/code&gt; and &lt;code&gt;value&lt;/code&gt; of the submit button which the user used to
		 * submit the form.&lt;/p&gt;
		 * @method _onFormButtonActivate
		 * @private
		 * @param {Event} evt The event object
		 */
		function _onFormButtonActivate( evt ) {
			var $button = $(this),
				$form = $(this.form);

			// save the used submit button
				$form.data( &#x27;_submitButton&#x27;, $button );

			if ( $button.attr( &#x27;name&#x27; ) ) {
				// remove the old field
					$form.find( &#x27;input.submit-action&#x27; ).remove();

				// create a new field with the buttons name and value
					$( &#x27;&lt;input&gt;&#x27; )
						.attr( &#x27;type&#x27;, &#x27;hidden&#x27; )
						.attr( &#x27;name&#x27;, $button.attr( &#x27;name&#x27; ) )
						.attr( &#x27;value&#x27;, $button.attr( &#x27;value&#x27; ) )
						.addClass( &#x27;submit-action&#x27; )
						.appendTo( $form );
			}
		}

		/**
		 * &lt;p&gt;The field onchange event handler. If the field has the &lt;code&gt;data-ajax-url&lt;/code&gt; attribute
		 * it is used as the trigger element. Otherwise, the fields form is considered to be the trigger
		 * element.&lt;/p&gt;
		 * @method _onFieldChange
		 * @private
		 * @param {Event} evt The event object
		 */
		function _onFieldChange( evt ) {
			TDI.Ajax.send( $(this).data( &#x27;ajax-url&#x27; ) ? this : this.form );
		}

		/**
		 * &lt;p&gt;The field onkeydown event handler. If the field has the &lt;code&gt;data-ajax-url&lt;/code&gt; attribute,
		 * a TDI ajax request is sent when Enter is pressed.&lt;/p&gt;
		 * @method _onFieldSubmit
		 * @private
		 * @param {Event} evt The event object
		 */
		function _onFieldSubmit( evt ) {
			if ( evt.keyCode === 13 &amp;&amp; $(this).data( &#x27;ajax-url&#x27; ) ) {
				evt.preventDefault();
				TDI.Ajax.send( this );
			}
		}

	// initialization
		_bindUI();

	// PUBLIC STUFF ------------------------------------------------------------
		return {
			/**
			 * &lt;p&gt;Universal method for sending a TDI.Ajax call. It is called internaly for all Ajax enabled
			 * elements (like Links, Forms, Selects, Inputs). This method may be used in other scripts as &lt;code&gt;TDI.Ajax.send( elm );&lt;/code&gt; where the &lt;code&gt;elm&lt;/code&gt; parameter points to the element, which would trigger the Ajax call if it was Ajax enabled.&lt;/p&gt;
			 *
			 * &lt;dl&gt;
			 *   &lt;dt&gt;There are some HTML attributes of the element, which are used to configure the call:&lt;/dt&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The target URL of the Ajax call&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;action&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The same as &lt;strong&gt;href&lt;/strong but used at Form elements&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-ajax-url&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The target URL of the Ajax call. Used if the Ajax URL should be different than the one defined by &lt;strong&gt;href&lt;/strong&gt; or &lt;strong&gt;action&lt;/strong&gt; attributes, or if the HTML element does not have URL attributes (select, input, ...)&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;method&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The HTTP method to be used for the Ajax request. Only for Form elements. &lt;strong&gt;Forms with &amp;lt;input type=&quot;file&quot;&amp;gt; elements will have forced POST method!&lt;/strong&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-ajax-method&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The HTTP method to be used for the Ajax request. The same as &lt;strong&gt;method&lt;/strong&gt; but applicable for all elements. If used on Form element, it has precedence before &lt;strong&gt;method&lt;/strong&gt; attribute (except Forms with file fields which have always POST method). Defaults to GET.&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-related-element&lt;/span&gt;&lt;/code&gt; &lt;span&gt;A selector pointing to a related element. This element(s) gets notified when the Ajax call starts/ends.&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd class=&quot;parameter_deprecated&quot;&gt;&lt;code&gt;&lt;span&gt;rel&lt;/span&gt;&lt;/code&gt; &lt;span&gt;(deprecated; use &lt;strong&gt;data-related-element&lt;/strong&gt; instead) The same as &lt;strong&gt;data-related-element&lt;/strong&gt;&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-related-ancestor&lt;/span&gt;&lt;/code&gt; &lt;span&gt;A selector pointing to a related parent element. This element gets notified when the Ajax call starts/ends&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;data-confirm&lt;/span&gt;&lt;/code&gt; &lt;span&gt;A confirmation message. Use when the user should be able to stop the Ajax call&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;disabled&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The Ajax call does not start if the element has the &lt;strong&gt;disabled&lt;/strong&gt; atribute set&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;class=&quot;disabled&quot;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;The Ajax call does not start if the element has a &lt;strong&gt;disabled&lt;/strong&gt; class name&lt;/span&gt;&lt;/dd&gt;
			 * &lt;/dl&gt;
			 * @method send
			 * @static
			 * @param {(String|jQuery|HTMLElement)} elm The element which is used as a trigger for the Ajax call.
			 * @param {Object} callbacks An optional set of callbacks:
			 *   &lt;dl&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeStart&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;If it returns false, the AJAX call and the default &lt;code&gt;start&lt;/code&gt; callback will not be executed.&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;start&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeEnd&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt; &lt;span&gt;If it returns false, the default &lt;code&gt;end&lt;/code&gt; callback will not be executed.&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;end&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/dd&gt;
			 *   &lt;/dl&gt;
			 */
			send : function( elm, callbacks ) {
				callbacks = callbacks || {};

				var $elm = $(elm),
					name = $elm.attr( &#x27;name&#x27; ),
					value = $elm.val(),
					confirm = $elm.data( &#x27;confirm&#x27; ),
					related = $elm.closest( $elm.data( &#x27;related-ancestor&#x27; ) || &#x27;&#x27; ).add( $( $elm.data( &#x27;related-element&#x27; ) || &#x27;&#x27; ) ).add( $( $elm.attr( &#x27;rel&#x27; ) || &#x27;&#x27; ) ).add( $( $elm.data( &#x27;_submitButton&#x27; ) || &#x27;&#x27; ) ),
					triggerGroup = $( $elm.data( &#x27;trigger-group&#x27; ) || &#x27;&#x27; ),
					url = $elm.data( &#x27;ajax-url&#x27; ) || $elm.attr( &#x27;href&#x27; ) || $elm.attr( &#x27;action&#x27; ),
					method = $elm.data( &#x27;ajax-method&#x27; ) || $elm.attr( &#x27;method&#x27; );
					xhrFields = $elm.data( &#x27;ajax-xhr-fields&#x27; ) || {},
					data = {};

				// if the URL is empty, try to use $elm.value
					if ( (url === &quot;&quot; || url === undefined) &amp;&amp; value ) {
						url = value;
					}

				// if the element has a name and value, append it to the GET URL
					if ( name &amp;&amp; value ) {
						if ( $elm.is( &#x27;input[type=checkbox]&#x27; ) &amp;&amp; $elm.prop( &#x27;checked&#x27; ) === false ) {
							data[ name ] = 0;
						}
						else {
							data[ name ] = value;
						}
					}

				// check for obstacles
					if ( $elm.is( &#x27;[disabled], .disabled&#x27; ) ) {
						return false;
					}
					if ( confirm &amp;&amp; !window.confirm( confirm ) ) {
						return false;
					}

				var _options = {
					beforeStart : function() {
						var res = callbacks.beforeStart &amp;&amp; callbacks.beforeStart.apply( this, arguments );
						if ( typeof res === &#x27;undefined&#x27; || res === true ) {
							$elm.add( related ).addClass( &#x27;loading&#x27; );
							triggerGroup.each( function() {
								var $trigger = $(this);
								if ( !$trigger.hasClass( &#x27;disabled&#x27; ) &amp;&amp; !$trigger.prop( &#x27;disabled&#x27; ) ) {
									$trigger.addClass( &#x27;disabled&#x27; ).prop( &#x27;disabled&#x27;, true );
									$trigger.data( &#x27;_disabled&#x27;, true );
								}
							} );
							/* deprecated */
								related.get(0) &amp;&amp; related.addClass( &#x27;loading-target&#x27; );

							callbacks.start &amp;&amp; callbacks.start.apply( this, arguments );
							return true;
						}
						return false;
					},
					beforeEnd : function() {
						var res = callbacks.beforeEnd &amp;&amp; callbacks.beforeEnd.apply( this, arguments );
						if ( typeof res === &#x27;undefined&#x27; || res === true ) {
							$elm.add( related ).removeClass( &#x27;loading&#x27; );
							triggerGroup.each( function( i, $trigger ) {
								var $trigger = $(this);
								if ( $trigger.data( &#x27;_disabled&#x27; ) === true ) {
									$trigger.removeClass( &#x27;disabled&#x27; ).prop( &#x27;disabled&#x27;, false );
									$trigger.data( &#x27;_disabled&#x27;, false );
								}
							} );
							/* deprecated */
								related.get(0) &amp;&amp; related.removeClass( &#x27;loading-target&#x27; );

							callbacks.end &amp;&amp; callbacks.end.apply( this, arguments );
						}
					},
					data : data,
					method : method,
					trigger : $elm,
					xhrFields : xhrFields
				};

				if ( $elm.is( &#x27;form&#x27; ) ) {
					_options.end = function() {
						$elm.data( &#x27;_submitButton&#x27;, null );
						$elm.find( &#x27;input.submit-action&#x27; ).remove();
					};
					
					TDI.Ajax.Request.sendForm( $elm, _options );
				}
				else {
					TDI.Ajax.Request.send( url, _options );
				}
			}
		};

}(jQuery);

/**
 * &lt;p&gt;The Request API for the TDI Ajax. Provides methods to send TDI requests.&lt;/p&gt;
 * @class Request
 * @namespace TDI.Ajax
 */
TDI.Ajax.Request = function($) {

	return {

		/**
		 * &lt;p&gt;Sends the Ajax request and calls the needed callback methods.&lt;/p&gt;
		 * @method send
		 * @static
		 * @param {String} url The request URL.
		 * @param {Object} options Aditional request options:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;method&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;The HTTP method used to send the request. Defaults to &lt;em&gt;get&lt;/em&gt;.&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;data&lt;/span&gt; &lt;span&gt;&amp;lt;(String|Object)&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Data to be sent to the server. It is converted to a query string, if not already a string. See jQuery documentation for &lt;a href=&quot;http://api.jquery.com/jQuery.ajax/&quot;&gt;$.ajax()&lt;/a&gt;&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;sync&lt;/span&gt; &lt;span&gt;&amp;lt;(Boolean)&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Whether the AJAX request should be synchronous or not. Defaults to &lt;em&gt;false&lt;/em&gt;&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeStart&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called before the request is sent. If this function returns &lt;em&gt;false&lt;/em&gt;, the request is not sent. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; the jqXHR object&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;settings&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; The settings map used in the jQuery $.ajax call&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;
		 *         &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;start&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called before the request is sent. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; The jqXHR object&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;settings&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; The settings map used in the jQuery $.ajax call&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;
		 *          &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeEnd&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called after the request is complete. If this function returns &lt;em&gt;false&lt;/em&gt;, the default &lt;em&gt;end&lt;/em&gt; callback is not executed. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; The jqXHR object&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;textStatus&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt; Status of the request (&quot;success&quot;, &quot;notmodified&quot;, &quot;error&quot;, &quot;timeout&quot;, &quot;abort&quot;, or &quot;parsererror&quot;)&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;
		 *         &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;end&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called after the request is complete. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt; The jqXHR object&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;textStatus&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt; Status of the request (&quot;success&quot;, &quot;notmodified&quot;, &quot;error&quot;, &quot;timeout&quot;, &quot;abort&quot;, or &quot;parsererror&quot;)&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/&gt;
		 *         &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		send : function( url, options ) {
			options = options || {};
			options.url = TDI.Ajax.Request.ajaxifyUrl( url );
			options.xhrFields = options.xhrFields || {};
			options.method = options.method || &#x27;GET&#x27;;
			options.async = !options.sync;
			options.data = options.data || &#x27;&#x27;;

			$.ajax( {
				url			: options.url,
				xhrFields   : options.xhrFields,
				type		: options.method,
				async       : options.async,
				data		: options.data,
				dataType	: &#x27;xml&#x27;,
				beforeSend	: function( xhr, settings ) {
					var res = options.beforeStart &amp;&amp; options.beforeStart( xhr, settings, options );
					if ( typeof res === &#x27;undefined&#x27; || res === true ) {
						$(document).trigger( &#x27;tdi:ajax:_start&#x27;, { xhr : xhr, settings : settings, options : options } );
						// TDI.Ajax.Response._start( xhr, settings, options );
						options.start &amp;&amp; options.start( xhr, settings, options );
						return true;
					}
					return false;
				},
				success		: function( data, textStatus, xhr ) {
					$(document).trigger( &#x27;tdi:ajax:_success&#x27;, { data : data, textStatus : textStatus, xhr : xhr, options : options } );
					// TDI.Ajax.Response._success( data, textStatus, xhr, options );
					options.success &amp;&amp; options.success( data, textStatus, xhr, options );
				},
				error		: function( xhr, textStatus, error ) {
					$(document).trigger( &#x27;tdi:ajax:_error&#x27;, { xhr : xhr, textStatus : textStatus, error : error, options : options } );
					// TDI.Ajax.Response._error( xhr, textStatus, error, options );
					options.error &amp;&amp; options.error( xhr, textStatus, error, options );
				},
				complete	: function( xhr, textStatus ) {
					var res = options.beforeEnd &amp;&amp; options.beforeEnd( xhr, textStatus, options );
					if ( typeof res === &#x27;undefined&#x27; || res === true ) {
						$(document).trigger( &#x27;tdi:ajax:_end&#x27;, { xhr : xhr, textStatus : textStatus, options : options } );
						// TDI.Ajax.Response._end( xhr, textStatus, options );
						options.end &amp;&amp; options.end( xhr, textStatus, options );
					}
				}
			} );
		},

		/**
		 * &lt;p&gt;Submits a form using an Iframe (fake Ajax call).&lt;/p&gt;
		 * @method sendForm
		 * @static
		 * @param {String|jQuery|HTMLElement} form The form element which will be sent.
		 * @param {Object} options Aditional request options:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeStart&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called before the request is sent. If this function returns &lt;em&gt;false&lt;/em&gt;, the request is not sent. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which is to be submited&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;
		 *         &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;start&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called before the request is sent. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which is to be submited&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;
		 *         &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;beforeEnd&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called after the request is complete. If this function returns &lt;em&gt;false&lt;/em&gt;, the default &lt;em&gt;end&lt;/em&gt; callback is not executed. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which was submited&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xml&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The response XML document&lt;/dd&gt;
		 *         &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;end&lt;/span&gt; &lt;span&gt;&amp;lt;Function&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *         &lt;span&gt;Function to be called after the request is complete. This function is called with parameters:&lt;/span&gt;
		 *         &lt;dl&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;form&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The form which was submited&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt; Aditional request options&lt;/dd&gt;
		 *           &lt;dd&gt;&lt;code&gt;&lt;span&gt;xml&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; The response XML document&lt;/dd&gt;
		 *         &lt;/dl&gt;
		 *       &lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		sendForm : function( form, options ) {
			options = options || {};

			var $form = $(form),
				$submitButton = $form.data( &#x27;_submitButton&#x27; ),
				url = $form.data( &#x27;ajax-url&#x27; ) || $form.attr( &#x27;action&#x27; );

			// send in iframe or through ajax
				if ($form.find(&quot;input[type=file]&quot;).length &gt; 0) {
					options.method = &quot;post&quot;;
				}
				else {
					options.data = $form.serialize(); // safe to overwrite
					options.method = options.method || $form.attr(&#x27;method&#x27;);

					TDI.Ajax.Request.send( url, options );
					return;
				}

			// onStart
				options.url = TDI.Ajax.Request.ajaxifyUrl( url );
				var res = options.beforeStart &amp;&amp; options.beforeStart( $form, options );
				if ( res === false ) {
					return false;
				}

				$(document).trigger( &#x27;tdi:ajax:_start&#x27;, { xhr : $form, settings : null, options : options } );
				// TDI.Ajax.Response._start( $form, null, options );
				options.start &amp;&amp; options.start( $form, options );
				if ( $submitButton ) {
					$submitButton.addClass( &#x27;loading&#x27; );
				}

			// prepare the form and its iframe
				var iframeName = &#x27;form_iframe_&#x27;+(new Date()).getTime(),
					iframe;

					// IE8- has a problem assigning the &#x60;name&#x60; attribute to a dynamicaly created Iframe. It needs to be created as a string.
					if ( document.documentMode &amp;&amp; document.documentMode &lt;= 8 ) {
						iframe = document.createElement( &#x27;&lt;iframe name=&quot;&#x27; + iframeName + &#x27;&quot;&gt;&#x27; );
					}
					else {
						iframe = document.createElement( &#x27;iframe&#x27; );
						iframe.name = iframeName;
					}

					iframe.style.display = &#x27;none&#x27;;
					document.body.appendChild( iframe );

					// onComplete/onEnd
						$(iframe).load( function() {
							var xml = this.contentWindow.document.XMLDocument || this.contentWindow.document,
								xhr = {
									responseXML : xml,
									responseText : (xml.body) ? xml.getElementsByTagName(&#x27;html&#x27;)[0].innerHTML : null
								};

							var res = options.beforeEnd &amp;&amp; options.beforeEnd( $form, options, xml );
							if ( res === false ) {
								return false;
							}

							if ( $submitButton ) {
								$submitButton.removeClass( &#x27;loading&#x27; );
							}

							$(document).trigger( &#x27;tdi:ajax:_success&#x27;, { data : xml, textStatus : &#x27;&#x27;, xhr : xhr, options : options } );
							$(document).trigger( &#x27;tdi:ajax:_end&#x27;, { xhr : $form, textStatus : null, options : options } );
							$form.trigger( &#x27;tdi:ajax:_formSubmit&#x27;, { form : $form, options : options, xhr : xhr, data : xml } );
							// TDI.Ajax.Response._success( xml, &#x27;&#x27;, null, options );
							// TDI.Ajax.Response._end( $form, null, options );
							options.end &amp;&amp; options.end( $form, options, xml );

							setTimeout( function() {
								$(iframe).unbind().remove();
								$form.removeAttr( &#x27;target&#x27; );
							}, 10000 );
						} );

					$form.attr( &#x27;action&#x27;, options.url );
					$form.attr( &#x27;method&#x27;, options.method || &#x27;post&#x27; );
					$form.attr( &#x27;target&#x27;, iframeName );
					$form.attr( &#x27;enctype&#x27;, &#x27;multipart/form-data&#x27; );

			/*
				Send the $form manualy.
				Needs to be the normal DOM method, jQuery submit() causes endless recursion of submit handlers.
			*/
				$form[0].submit();
		},

		/**
		 * &lt;p&gt;Modifies the URL and adds an Ajax (tdi) flag.&lt;/p&gt;
		 * @method ajaxifyUrl
		 * @static
		 * @param {String} url The URL to modify
		 * @return {String} The modified URL
		 */
		ajaxifyUrl : function( url ) {
			var p = &#x27;_infuse=1&amp;_ts=&#x27;+(new Date()).getTime();
			if ( url.indexOf( &#x27;?#&#x27; ) &gt; 0 ) {
				return url.replace( /\?#/, &#x27;?&#x27;+p+&#x27;#&#x27; );
			}
			else if ( url.indexOf( &#x27;&amp;#&#x27; ) &gt; 0 ) {
				return url.replace( /&amp;#/, &#x27;&amp;&#x27;+p+&#x27;#&#x27; );
			}
			else if ( url.indexOf( &#x27;?&#x27; ) &gt; 0 ) {
				return url.replace( /\?/, &#x27;?&#x27;+p+&#x27;&amp;&#x27; );
			}
			else if ( url.indexOf( &#x27;#&#x27; ) &gt;= 0 ) {
				return url.replace( /#/, &#x27;?&#x27;+p+&#x27;#&#x27; );
			}
			else {
				return url + &#x27;?&#x27;+p;
			}
		}

	};

}(jQuery);

/**
 * &lt;p&gt;The Response API for the TDI AJAX. Provides a set of custom &lt;em&gt;tdi&lt;/em&gt; events which can be used
 * to control or to react to the TDI responses.&lt;/p&gt;
 * @class Response
 */
TDI.Ajax.Response = function($) {
	// Listen for ajax internal events
		$(document).bind( &#x27;tdi:ajax:_start&#x27;, function( evt, data ) {
			_start( data.xhr, data.settings, data.options );
		} );
		$(document).bind( &#x27;tdi:ajax:_success&#x27;, function( evt, data ) {
			_success( data.data, data.textStatus, data.xhr, data.options );
		} );
		$(document).bind( &#x27;tdi:ajax:_error&#x27;, function( evt, data ) {
			_error( data.xhr, data.textStatus, data.error, data.options );
		} );
		$(document).bind( &#x27;tdi:ajax:_end&#x27;, function( evt, data ) {
			_end( data.xhr, data.textStatus, data.options );
		} );

	// Supported Infusion instructions
		var _infusionInstructions = {
				&#x27;update&#x27;	: _onBeforeUpdate,
				&#x27;insert&#x27;	: _onBeforeInsert,
				&#x27;script&#x27;	: _onBeforeScript,
				&#x27;style&#x27;		: _onBeforeStyle,
				&#x27;reload&#x27;	: _onBeforeReload,
				&#x27;redirect&#x27;	: _onBeforeRedirect,
				&#x27;popup&#x27;		: _onBeforePopup
			};

	// a collection of new script tags which will be added after the response is done to preserve the execution order
		var _scriptTags = [];

	// a collection of responses used for the &#x27;tdi:ajax:done&#x27; event
		var _responses = {
			updates : [],
			inserts : [],
			scripts : [],
			styles : [],
			popups : [],
			unknowns : []
		};

	// CALLBACKS -----------------------------------------------------------------
		/**
		 * &lt;p&gt;The default &lt;em&gt;start&lt;/em&gt; callback.&lt;/p&gt;
		 * @method _start
		 * @private
		 * @param {jqXHR} xhr The jqXHR object
		 * @param {Object} settings The Ajax settings
		 * @param {Object} options Additional request options
		 */
		function _start( xhr, settings, options ) {
			// xhr.setRequestHeader( &#x27;X-Requested-Format&#x27;, &#x27;xml&#x27; );
			/**
			 * &lt;p&gt;Fires when the TDI request has started.&lt;/p&gt;
			 * @event tdi:ajax:start
			 * @param {Event} evt The event object
			 * @param {Object} data The event data:
			 *   &lt;dl&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;The jqXHR object&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;settings&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;The Ajax settings&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;/dl&gt;
			 */
			$(document).trigger( &#x27;tdi:ajax:start&#x27;, [{
				xhr : xhr,
				options : options,
				settings : settings
			}] );
		}

		/**
		 * &lt;p&gt;The default &lt;em&gt;success&lt;/em&gt; callback.&lt;/p&gt;
		 * @method _success
		 * @private
		 * @param {jQuery} xml The response XML document
		 * @param {String} textStatus The status of the response
		 * @param {jqXHR} xhr The jqXHR object
		 * @param {Object} options Additional request options
		 */
		function _success( xml, textStatus, xhr, options ) {
			if ( !xml ) {
				_error( xhr, textStatus, null, options );
				return false;
			}

			var $xml = $(xml),
				status = $xml.find( &#x27;status&#x27; );

			// check for status
				if ( status.text().toLowerCase() != &#x27;ok&#x27; ) {
					_error( xhr, textStatus, status.text(), options );
				}

			// handle tags
				$xml.find(&quot;response &gt; *:not(status)&quot;).each(function( ) {
					var instruction = this.tagName.toLowerCase();
					switch( instruction ) {
						case &#x27;Script&#x27;:
								// collect all script tags to a list, so they can be downloaded and executed in the preserved order
								_scriptTags.push( this );
							break;
						default:
								if (_infusionInstructions[ instruction ]) {
									_infusionInstructions[ instruction ]( this, options );
								}
								else {
									_onBeforeUnknown( this, options );
								}
							break;
					}
				});

				// download and execute the list of script tags
					_onBeforeScript( _scriptTags.shift(), options );

				// fire the custom ajax:done events
					/**
					 * &lt;p&gt;Fires when all TDI &amp;lt;update&amp;gt;s are done.&lt;/p&gt;
					 * @event tdi:ajax:updatesDone
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;updates&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The list of all updates&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:updatesDone&#x27;, [{
						updates : _responses.updates,
						options : options
					}] );
					/**
					 * &lt;p&gt;Fires when all TDI &amp;lt;insert&amp;gt;s are done.&lt;/p&gt;
					 * @event tdi:ajax:insertsDone
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;inserts&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The list of all inserts&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:insertsDone&#x27;, [{
						inserts : _responses.inserts,
						options : options
					}] );
					/**
					 * &lt;p&gt;Fires when all TDI &amp;lt;script&amp;gt;s are done.&lt;/p&gt;
					 * @event tdi:ajax:scriptsDone
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;scripts&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The list of all scripts&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:scriptsDone&#x27;, [{
						scripts : _responses.scripts,
						options : options
					}] );
					/**
					 * &lt;p&gt;Fires when all TDI &amp;lt;style&amp;gt;s are done.&lt;/p&gt;
					 * @event tdi:ajax:stylesDone
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;styles&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The list of all styles&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:stylesDone&#x27;, [{
						styles : _responses.styles,
						options : options
					}] );
					/**
					 * &lt;p&gt;Fires when all TDI &amp;lt;popup&amp;gt;s are done.&lt;/p&gt;
					 * @event tdi:ajax:popupsDone
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;popups&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The list of all popups&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:popupsDone&#x27;, [{
						popups : _responses.popups,
						options : options
					}] );
					/**
					 * &lt;p&gt;Fires when all &amp;lt;unknown&amp;gt; TDI instructions are done.&lt;/p&gt;
					 * @event tdi:ajax:unknownsDone
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;instructions&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The list of all unknown instructions&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:unknownsDone&#x27;, [{
						unknowns : _responses.unknowns,
						options : options
					}] );
					/**
					 * &lt;p&gt;Fires when all TDI actions are done.&lt;/p&gt;
					 * @event tdi:ajax:done
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;responses&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The list of all TDI actions&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:done&#x27;, [{
						responses : _responses,
						options : options
					}] );
		}

		/**
		 * &lt;p&gt;The default &lt;em&gt;error&lt;/em&gt; callback.&lt;/p&gt;
		 * @method _error
		 * @private
		 * @param {jqXHR} xhr The jqXHR object
		 * @param {String} textStatus The status of the response
		 * @param {String} error The error message
		 * @param {Object} options Additional request options
		 */
		function _error( xhr, textStatus, error, options ) {
			/**
			 * &lt;p&gt;Fires when the Ajax request ends with an error.&lt;/p&gt;
			 * @event tdi:ajax:error
			 * @param {Event} evt The event object
			 * @param {Object} data The event data:
			 *   &lt;dl&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;status&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;The XHR status text (if available)&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;message&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;The error message&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;xhr&lt;/span&gt; &lt;span&gt;&amp;lt;jqXHR&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;The jqXHR object (see jQuery documentation for jQuery.ajax())&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;textStatus&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;The XHR text status (if available)&lt;/span&gt;&lt;/dd&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;/dl&gt;
			 */
			$(document).trigger( &#x27;tdi:ajax:error&#x27;, [{
				status : xhr ? xhr.status : &#x27;N/A&#x27;,
				message : error || &#x27;Invalid Ajax response. The response must be a valid XML.&#x27;,
				xhr : xhr,
				textStatus : textStatus,
				options : options
			}] );
		}

		/**
		 * &lt;p&gt;The default &lt;em&gt;end&lt;/em&gt; callback.&lt;/p&gt;
		 * @method _end
		 * @private
		 */
		function _end( xhr, textStatus, options ) {
			/**
			 * &lt;p&gt;Fires when the TDI request has ended.&lt;/p&gt;
			 * @event tdi:ajax:end
			 * @param {Event} evt The event object
			 * @param {Object} data The event data:
			 *   &lt;dl&gt;
			 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Array&amp;gt;&lt;/span&gt;&lt;/code&gt;
			 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
			 *   &lt;/dl&gt;
			 */
			$(document).trigger( &#x27;tdi:ajax:end&#x27;, [{
				options : options
			}] );
		}

	// RESPONSES -----------------------------------------------------------------
		/**
		 * &lt;p&gt;The beforeUpdate callback. It takes the &amp;lt;update&amp;gt; xml node, gets its data and triggers a custom event which
		 * can stop the default update action.&lt;/p&gt;
		 *
		 * @method _onBeforeUpdate
		 * @private
		 * @param {XMLNode} tag The &amp;lt;update&amp;gt; xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforeUpdate( tag, options ) {
			if ( !tag ) { return false; }

			var $tag = $(tag),
				target_id = $tag.attr( &#x27;target&#x27; ),
				selector = $tag.attr( &#x27;selector&#x27; ),
				target = selector ? $(selector) : $( &#x27;#&#x27; + target_id ),
				content = $.trim( $tag.text() ),
				replace = $tag.attr( &#x27;replace&#x27; ),
				append = $tag.attr( &#x27;append&#x27; ),
				prepend = $tag.attr( &#x27;prepend&#x27; ),
				class_add = $tag.attr( &#x27;class-add&#x27; ) || &#x27;&#x27;,
				class_remove = $tag.attr( &#x27;class-remove&#x27; ) || &#x27;&#x27;,
				event_data = {
					target_id		: target_id,
					selector        : selector,
					target			: target,
					content			: content,
					content_empty	: (content.replace( /\&amp;nbsp;/g, &#x27;&#x27; ).length === 0),
					replace			: replace,
					append			: append,
					prepend			: prepend,
					class_add		: class_add,
					class_remove	: class_remove,
					options			: options
				};

			if ( target.length &gt; 0 ) {
				// fire custom events
					/**
					 * &lt;p&gt;Fires before the TDI &lt;em&gt;update&lt;/em&gt; takes place.&lt;/p&gt;
					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onUpdateDefault&lt;/code&gt;).&lt;/p&gt;
					 * @event tdi:ajax:beforeUpdate
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;selector&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;CSS selector for multiple targets&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The update contents&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content_empty&lt;/span&gt; &lt;span&gt;&amp;lt;Boolean&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Indicates whether the contents are empty&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;replace&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Indicates whether the contents will replace the whole target&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;append&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Indicates whether the contents will be appended to the end of the target&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;prepend&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Indicates whether the contents will be prepended to the beginning of the target&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_add&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Space separated list of class names to add&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_remove&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Space separates list of class names to remove&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					target.first().trigger( &#x27;tdi:ajax:beforeUpdate&#x27;, event_data );

					_responses.updates.push( event_data );
			}
		}

		/**
		 * &lt;p&gt;The beforeInsert callback. It takes the &amp;lt;insert&amp;gt; xml node, gets its data and triggers a custom event which
		 * can stop the default insert action.&lt;/p&gt;
		 *
		 * @method _onBeforeInsert
		 * @private
		 * @param {XMLNode} tag The &amp;lt;insert&amp;gt; xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforeInsert( tag, options ) {
			if ( !tag ) { return false; }

			var $tag = $(tag),
				target_id = $tag.attr( &#x27;target&#x27; ),
				selector = $tag.attr( &#x27;selector&#x27; ),
				target = selector ? $(selector) : $( &#x27;#&#x27; + target_id ),
				content = $.trim( $tag.text() ),
				position = $tag.attr( &#x27;position&#x27; ) || &#x27;after&#x27;,
				inserted_node,
				event_data = {
					target_id		: target_id,
					selector        : selector,
					target			: target,
					content			: content,
					position		: position,
					inserted_node	: inserted_node,
					options			: options
				};

			if ( target.length &gt; 0 ) {
				// fire custom events
					/**
					 * &lt;p&gt;Fires before the TDI &lt;em&gt;insert&lt;/em&gt; takes place.&lt;/p&gt;
					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onInsertDefault&lt;/code&gt;).&lt;/p&gt;
					 * @event tdi:ajax:beforeInsert
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The contents&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;position&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The position of the insert (before|after)&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					target.first().trigger( &#x27;tdi:ajax:beforeInsert&#x27;, event_data );

					_responses.inserts.push( event_data );
			}
		}

		/**
		 * &lt;p&gt;The beforeScript callback. It takes the &amp;lt;script&amp;gt; xml node, gets its data and triggers a custom event which
		 * can stop the default script action.&lt;/p&gt;
		 *
		 * @method _onBeforeScript
		 * @private
		 * @param {XMLNode} tag The &amp;lt;script&amp;gt; xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforeScript( tag, options ) {
			if ( !tag ) { return false; }

			var $tag = $(tag),
				contents = $.trim( $tag.text() ),
				src = $tag.attr( &#x27;src&#x27; ),
				id = $tag.attr( &#x27;id&#x27; ),
				event_data = {
					script_src	: src,
					script_data	: contents,
					script_id	: id,
					options		: options
				};

			// fire custom events
				/**
				 * &lt;p&gt;Fires before the TDI &lt;em&gt;script&lt;/em&gt; takes place.&lt;/p&gt;
				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onScriptDefault&lt;/code&gt;).&lt;/p&gt;
				 * @event tdi:ajax:beforeScript
				 * @param {Event} evt The event object
				 * @param {Object} data The event data:
				 *   &lt;dl&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Path to the external Javascript file&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_data&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Inline Javascript code&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;ID of the &amp;lt;script&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;
				 *   &lt;/dl&gt;
				 */
				$(document).trigger( &#x27;tdi:ajax:beforeScript&#x27;, event_data );

				_responses.scripts.push( event_data );
		}

		/**
		 * &lt;p&gt;The beforeStyle callback. It takes the &amp;lt;style&amp;gt; xml node, gets its data and triggers a custom event which
		 * can stop the default style action.&lt;/p&gt;
		 *
		 * @method _onBeforeStyle
		 * @private
		 * @param {XMLNode} tag The &amp;lt;style&amp;gt; xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforeStyle( tag, options ) {
			if ( !tag ) { return false; }

			var $tag = $(tag),
				src = $tag.attr( &#x27;src&#x27; ),
				id = $tag.attr( &#x27;id&#x27; ),
				event_data = {
					style_src	: src,
					style_id	: id,
					options		: options
				};

			// fire custom events
				/**
				 * &lt;p&gt;Fires before the TDI &lt;em&gt;style&lt;/em&gt; takes place.&lt;/p&gt;
				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onStyleDefault&lt;/code&gt;).&lt;/p&gt;
				 * @event tdi:ajax:beforeStyle
				 * @param {Event} evt The event object
				 * @param {Object} data The event data:
				 *   &lt;dl&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Path to the external CSS file&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;ID of the &amp;lt;link&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;
				 *   &lt;/dl&gt;
				 */
				$(document).trigger( &#x27;tdi:ajax:beforeStyle&#x27;, event_data );

				_responses.styles.push( event_data );
		}

		/**
		 * &lt;p&gt;The beforeReload callback. It just reloads the page.&lt;/p&gt;
		 *
		 * @method _onBeforeReload
		 * @private
		 * @param {XMLNode} tag The &amp;lt;reload&amp;gt; xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforeReload( tag, options ) {
			// fire custom events
				/**
				 * &lt;p&gt;Fires before the TDI &lt;em&gt;reload&lt;/em&gt; takes place.&lt;/p&gt;
				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onReloadDefault&lt;/code&gt;).&lt;/p&gt;
				 * @event tdi:ajax:beforeReload
				 * @param {Event} evt The event object
				 */
				$(document).trigger( &#x27;tdi:ajax:beforeReload&#x27;, {options : options} );
		}

		/**
		 * &lt;p&gt;The before redirect callback. It takes the &amp;lt;redirect&amp;gt; xml node, gets its data and redirects
		 * the page to the given URL.&lt;/p&gt;
		 *
		 * @method _onBeforeRedirect
		 * @private
		 * @param {XMLNode} tag The &amp;lt;redirect&amp;gt; xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforeRedirect( tag, options ) {
			if ( !tag ) { return false; }

			var $tag = $(tag),
				href = $tag.attr( &#x27;href&#x27; );

			if ( href ) {
				// fire custom events
					/**
					 * &lt;p&gt;Fires before the TDI &lt;em&gt;redirect&lt;/em&gt; takes place.&lt;/p&gt;
					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onRedirectDefault&lt;/code&gt;).&lt;/p&gt;
					 * @event tdi:ajax:beforeRedirect
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The URL to redirect to&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:beforeRedirect&#x27;, { href : href, options : options } );
			}
		}

		/**
		 * &lt;p&gt;The beforePopup callback. It takes the &amp;lt;popup&amp;gt; xml node, gets its data and triggers a custom event which
		 * can stop the default popup action.&lt;/p&gt;
		 *
		 * @method _onBeforePopup
		 * @private
		 * @param {XMLNode} tag The &amp;lt;popup&amp;gt; xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforePopup( tag, options ) {
			if ( !tag ) { return false; }

			var $tag = $(tag),
				mode = $tag.attr( &#x27;mode&#x27; ) || &#x27;popup&#x27;,
				href = $tag.attr( &#x27;href&#x27; ),
				width = $tag.attr( &#x27;width&#x27; ) || 600,
				height = $tag.attr( &#x27;height&#x27; ) || 500,
				event_data = {
					href	: href,
					mode	: mode,
					width	: parseInt(width),
					height	: parseInt(height),
					options	: options
				};

			if ( href ) {
				// fire custom events
					/**
					 * &lt;p&gt;Fires before the TDI &lt;em&gt;popup&lt;/em&gt; takes place.&lt;/p&gt;
					 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onPopupDefault&lt;/code&gt;).&lt;/p&gt;
					 * @event tdi:ajax:beforePopup
					 * @param {Event} evt The event object
					 * @param {Object} data The event data:
					 *   &lt;dl&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The URL of the popup&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;mode&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;The mode of the popup (popup|dialog)&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Width of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;
					 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;
					 *       &lt;span&gt;Height of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;
					 *   &lt;/dl&gt;
					 */
					$(document).trigger( &#x27;tdi:ajax:beforePopup&#x27;, event_data );
					_responses.popups.push( event_data );
			}
		}

		/**
		 * &lt;p&gt;The beforeUnknown callback. It takes an unknown instruction xml node, gets its data and triggers a custom event which
		 * can stop the default unknown action.&lt;/p&gt;
		 *
		 * @method _onBeforeUnknown
		 * @private
		 * @param {XMLNode} tag The unknown instruction xml tag
		 * @param {Object} options Additional request options
		 */
		function _onBeforeUnknown( tag, options ) {
			if ( !tag ) { return false; }

			var $tag = $(tag),
				name = tag.tagName.toLowerCase(),
				beforeName = name.substr(0, 1).toUpperCase() + name.substr(1),
				attributes = tag.attributes,
				event_data = {
					_name : name,
					contents : $.trim( $tag.text() )
				};

			for (var i = 0, l = attributes.length; i &lt; l; i++) {
				event_data[attributes[i].name] = attributes[i].value;
			}

			// fire custom events
				/**
				 * &lt;p&gt;Fires before the TDI instruction takes place.&lt;/p&gt;
				 * &lt;p&gt;This event is &lt;strong&gt;preventable&lt;/strong&gt;. Use &lt;a href=&quot;http://api.jquery.com/event.preventDefault/&quot;&gt;preventDefault()&lt;/a&gt; to prevent the default action (&lt;code&gt;Response._onUnknownDefault&lt;/code&gt;).&lt;/p&gt;
				 * @event tdi:ajax:beforeUnknown
				 * @param {Event} evt The event object
				 * @param {Object} data The event data:
				 *   &lt;dl&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Instruction contents&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;ATTRS_NAME&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Other attributes&lt;/dd&gt;
				 *   &lt;/dl&gt;
				 */
				$.event.special[ &#x27;tdi:ajax:before&#x27; + beforeName ] = {
					_default : customDefault
				};

				$(document).trigger( &#x27;tdi:ajax:before&#x27; + beforeName, event_data );
				_responses.unknowns.push( event_data );
		}

	// RESPONSES DEFAULTS
		/**
		 * &lt;p&gt;The update default response handler. Updates the specified target with new contents.&lt;/p&gt;
		 * @method _onUpdateDefault
		 * @private
		 * @param {Object} evt The event object
		 * @param {Object} data The update data object:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;The ID of the target element&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;selector&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;CSS selector for multiple targets&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;The target element&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;The new HTML contents&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;replace&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;(&quot;true&quot;|&quot;false&quot;) Whether to update the targets contents, or to replace the whole target&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;append&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;(&quot;true&quot;|&quot;false&quot;) Whether to append the new contents at the end of the target&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;prepend&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;(&quot;true&quot;|&quot;false&quot;) Whether to prepend the new contents at the begining of the target&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_add&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;CSS class name(s) which will be added to the target. Multiple class names are separated by a space&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_remove&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;CSS class name(s) which will be added to the target. Multiple class names are separated by a space&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 *    &lt;/dl&gt;
		 */
		function _onUpdateDefault( evt, data ) {
			// classes
				data.target.removeClass( data.class_remove ).addClass( data.class_add );

			// update the target element
				if ( data.replace === &#x27;true&#x27; ) {
					data.target.find( &#x27;*&#x27; ).andSelf().unbind(); // detach all event handlers from the target and its child nodes
					data.target.replaceWith( data.content );
				}
				else if ( data.append === &#x27;true&#x27; ) {
					data.target.append( data.content );
				}
				else if ( data.prepend === &#x27;true&#x27; ) {
					data.target.prepend( data.content );
				}
				else {
					data.target.find( &#x27;*&#x27; ).unbind(); // detach all event handlers from the targets child nodes
					data.target.html( data.content );
				}

			// trigger the update event
				/**
				 * &lt;p&gt;Fires after the TDI &lt;em&gt;update&lt;/em&gt; takes place.&lt;/p&gt;
				 * @event tdi:ajax:update
				 * @param {Event} evt The event object
				 * @param {Object} data The event data:
				 *   &lt;dl&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The update contents&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content_empty&lt;/span&gt; &lt;span&gt;&amp;lt;Boolean&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Indicates whether the contents are empty&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;replace&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Indicates whether the contents will replace the whole target&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;append&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Indicates whether the contents will be appended to the end of the target&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;prepend&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Indicates whether the contents will be prepended to the beginning of the target&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_add&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Space separated list of class names to add&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;class_remove&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Space separates list of class names to remove&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
				 *   &lt;/dl&gt;
				 */
				data.target.trigger( &#x27;tdi:ajax:update&#x27;, data );
		}

		/**
		 * &lt;p&gt;The insert default response handler. Inserts the contents before/after the target.&lt;/p&gt;
		 * @method _onInsertDefault
		 * @private
		 * @param {Object} evt The event object
		 * @param {Object} data The insert data object:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;The ID of the target element&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;The target element&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;The new HTML contents&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;position&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;(&quot;before&quot;|&quot;after&quot;) Whether to insert the contents before, or after the target&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		function _onInsertDefault( evt, data ) {
			data.inserted_node = $( data.content )[ (data.position === &#x27;before&#x27;) ? &#x27;insertBefore&#x27; : &#x27;insertAfter&#x27; ]( data.target );

			// trigger the insert event
				/**
				 * &lt;p&gt;Fires after the TDI &lt;em&gt;insert&lt;/em&gt; takes place.&lt;/p&gt;
				 * @event tdi:ajax:insert
				 * @param {Event} evt The event object
				 * @param {Object} data The event data:
				 *   &lt;dl&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The ID of the update target&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;target&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The update target&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;content&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The contents&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;position&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The position of the insert (before|after)&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;inserted_node&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt; Reference to the inserted HTML node&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
				 *   &lt;/dl&gt;
				 */
				data.target.trigger( &#x27;tdi:ajax:insert&#x27;, data );
		}

		/**
		 * &lt;p&gt;The script default response handler. Loads and executes new scripts.&lt;/p&gt;
		 * @method _onScriptDefault
		 * @private
		 * @param {Object} evt The event object
		 * @param {Object} data The script data object:
		 * &lt;dl&gt;
		 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *     &lt;span&gt;URL of the new external script&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_data&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *     &lt;span&gt;Inline script data&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *     &lt;span&gt;ID of the &amp;lt;script&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 * &lt;/dl&gt;
		 */
		function _onScriptDefault( evt, data ) {
			var scripts = _scriptTags,
				download = true,
				onComplete = function( node ) {
					var s;

					// execute inline script
					if ( data.script_data ) {
						s = document.createElement( &#x27;script&#x27; );
						s.type = &#x27;text/javascript&#x27;;
						s.text = data.script_data;
						if ( data.script_id ) {
							s.id = data.script_id + &#x27;_inline&#x27;;
						}
						document.getElementsByTagName(&#x27;head&#x27;)[0].appendChild(s);
					}

					// trigger the script event
						data.script_node = node;
						data.script_node_inline = s;
						/**
						 * &lt;p&gt;Fires after the TDI &lt;em&gt;script&lt;/em&gt; takes place.&lt;/p&gt;
						 * @event tdi:ajax:script
						 * @param {Event} evt The event object
						 * @param {Object} data The event data:
						 *   &lt;dl&gt;
						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
						 *       &lt;span&gt;Path to the external Javascript file&lt;/span&gt;&lt;/dd&gt;
						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_data&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
						 *       &lt;span&gt;Inline Javascript code&lt;/span&gt;&lt;/dd&gt;
						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
						 *       &lt;span&gt;ID of the &amp;lt;script&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;
						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;script_node&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
						 *       &lt;span&gt;Reference to the inserted &amp;lt;script&amp;gt; node&lt;/span&gt;&lt;/dd&gt;
						 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
						 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
						 *   &lt;/dl&gt;
						 */
						$(document).trigger( &#x27;tdi:ajax:script&#x27;, data );

					// process next script
						_onBeforeScript( scripts.shift() );
				};

			// if there is an &#x27;src&#x27; attribute, load the script first and when fully loaded, execute the script contents
				if ( data.script_src ) {
					if ( data.script_id &amp;&amp; $( &#x27;#&#x27;+data.script_id ).length &gt; 0 ) {
						download = false;
					}
					if ( download ) {
						TDI.Tools.getScript( data.script_src, {
							id : data.script_id,
							complete : onComplete
						} );
					}
				}
				else {
					onComplete();
				}
		}

		/**
		 * &lt;p&gt;The style default response handler. Loads external stylesheets.&lt;/p&gt;
		 * @method _onStyleDefault
		 * @private
		 * @param {Object} evt The event object
		 * @param {Object} data The style data object:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;URL of the new external stylesheet&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;ID of the &amp;lt;link&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		function _onStyleDefault( evt, data ) {
			var download = true;
			if ( data.style_id &amp;&amp; $( &#x27;#&#x27;+data.style_id ).length &gt; 0 ) {
				download = false;
			}
			if ( download ) {
				TDI.Tools.getStyle( data.style_src, {
					id : data.style_id,
					complete : function( node ) {
						// trigger the style event
							data.style_node = node;
							/**
							 * &lt;p&gt;Fires after the TDI &lt;em&gt;style&lt;/em&gt; takes place.&lt;/p&gt;
							 * @event tdi:ajax:style
							 * @param {Event} evt The event object
							 * @param {Object} data The event data:
							 *   &lt;dl&gt;
							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_src&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
							 *       &lt;span&gt;Path to the external CSS file&lt;/span&gt;&lt;/dd&gt;
							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_id&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
							 *       &lt;span&gt;ID of the &amp;lt;link&amp;gt; tag&lt;/span&gt;&lt;/dd&gt;
							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;style_node&lt;/span&gt; &lt;span&gt;&amp;lt;jQuery&amp;gt;&lt;/span&gt;&lt;/code&gt;
							 *       &lt;span&gt;Reference to the inserted &amp;lt;link&amp;gt; node&lt;/span&gt;&lt;/dd&gt;
							 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
							 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
							 *   &lt;/dl&gt;
							 */
							$(document).trigger( &#x27;tdi:ajax:style&#x27;, data );
					}
				} );
			}
		}

		/**
		 * &lt;p&gt;The reload default response handler. Reloads the page.&lt;/p&gt;
		 * @method _onReloadDefault
		 * @private
		 * @param {Object} data The reload data object
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		function _onReloadDefault( evt, data ) {
			window.location.reload( true );
		}

		/**
		 * &lt;p&gt;The redirect default response handler. Redirects the page to a given URL.&lt;/p&gt;
		 * @method _onRedirectDefault
		 * @private
		 * @param {Object} evt The event object
		 * @param {Object} data The redirect data object:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;URL of the redirect&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		function _onRedirectDefault( evt, data ) {
			window.location.assign( data.href );
		}

		/**
		 * &lt;p&gt;The popup default response handler.&lt;/p&gt;
		 * @method _onPopupDefault
		 * @private
		 * @param {Object} evt The event object
		 * @param {Object} data The popup data object:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Target URL of the popup&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;mode&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;(&quot;popup&quot;|&quot;dialog&quot;) The type of the popup&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Width of the popup in mode &quot;dialog&quot;&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Height of the popup in mode &quot;dialog&quot;&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		function _onPopupDefault( evt, data ) {
			var params = &#x27;&#x27;,
				popup;

			if ( data.mode === &#x27;dialog&#x27; ) {
				params += &#x27;width=&#x27;+data.width+&#x27;, height=&#x27;+data.height;
			}

			data.popup = window.open( data.href, &#x27;_blank&#x27;, params );

			// trigger the popup event
				/**
				 * &lt;p&gt;Fires after the TDI &lt;em&gt;popup&lt;/em&gt; takes place.&lt;/p&gt;
				 * @event tdi:ajax:popup
				 * @param {Event} evt The event object
				 * @param {Object} data The event data:
				 *   &lt;dl&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;href&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The URL of the popup&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;mode&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;The mode of the popup (popup|dialog)&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;width&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Width of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;height&lt;/span&gt; &lt;span&gt;&amp;lt;Integer&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Height of the popup. Available only for &lt;em&gt;dialog&lt;/em&gt; mode&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;popup&lt;/span&gt; &lt;span&gt;&amp;lt;window&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Reference to the opened &lt;em&gt;window&lt;/em&gt;&lt;/span&gt;&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
				 *   &lt;/dl&gt;
				 */
				$(document).trigger( &#x27;tdi:ajax:popup&#x27;, data );
		}

		/**
		 * &lt;p&gt;The unknown instruction default response handler.&lt;/p&gt;
		 * @method _onUnknownDefault
		 * @private
		 * @param {Object} evt The event object
		 * @param {Object} data The dialog data object:
		 *   &lt;dl&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Instruction contents&lt;/span&gt;&lt;/dd&gt;
		 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;options&lt;/span&gt; &lt;span&gt;&amp;lt;Object&amp;gt;&lt;/span&gt;&lt;/code&gt;
		 *       &lt;span&gt;Additional request options&lt;/span&gt;&lt;/dd&gt;
		 *   &lt;/dl&gt;
		 */
		function _onUnknownDefault( evt, data ) {
			// trigger the dialog event
				/**
				 * &lt;p&gt;Fires after the TDI unknown instruction takes place.&lt;/p&gt;
				 * @event tdi:ajax:unknown
				 * @param {Event} evt The event object
				 * @param {Object} data The event data:
				 *   &lt;dl&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;contents&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Instruction contents&lt;/dd&gt;
				 *     &lt;dd&gt;&lt;code&gt;&lt;span&gt;ATTRS_NAME&lt;/span&gt; &lt;span&gt;&amp;lt;String&amp;gt;&lt;/span&gt;&lt;/code&gt;
				 *       &lt;span&gt;Other attributes&lt;/dd&gt;
				 *   &lt;/dl&gt;
				 */
				$(document).trigger( &#x27;tdi:ajax:&#x27; + data._name, data );
		}

	// TDI Ajax custom events -------------------------------------------------
		var i,
			customHandlers = {
				&#x27;tdi:ajax:beforeUpdate&#x27;		: _onUpdateDefault,
				&#x27;tdi:ajax:beforeInsert&#x27;		: _onInsertDefault,
				&#x27;tdi:ajax:beforeScript&#x27;		: _onScriptDefault,
				&#x27;tdi:ajax:beforeStyle&#x27;		: _onStyleDefault,
				&#x27;tdi:ajax:beforeReload&#x27;		: _onReloadDefault,
				&#x27;tdi:ajax:beforeRedirect&#x27;	: _onRedirectDefault,
				&#x27;tdi:ajax:beforePopup&#x27;		: _onPopupDefault
			},
			customDefault = function( evt, data ) {
				if (customHandlers[ evt.type ]) {
					customHandlers[ evt.type ].call( this, evt, ($.isArray(data) ? data[1] : data) );
				}
				else {
					_onUnknownDefault.call( this, evt, ($.isArray(data) ? data[1] : data) );
				}
			};

		for ( i in customHandlers ) {
			$.event.special[ i ] = {
				_default : customDefault
			};
		}

	// PUBLIC STUFF
		return {};

}(jQuery);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
